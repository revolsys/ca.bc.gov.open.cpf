





 

 
 
 

 

 
 
     <!doctype html>
<!--
 Generated by Apache Maven Doxia  at 2021-Mar-15  Rendered using Reflow Maven Skin 2.0.2 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
                                                                  
                    <head>
    <meta charset="UTF-8" />
    <title>Concurrent Processing Framework &#x2013; Plug-in Guide</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
      <meta http-equiv="content-language" content="en" />
                                                        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v${fontawesomeVersion}/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link href="./css/docs.css" rel="stylesheet" />
    <link href="./css/reflow-skin.css" rel="stylesheet" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css" />

    <link href="./css/lightbox.css" rel="stylesheet" />
    <link href="./css/site.css" rel="stylesheet" />
    <link href="./css/print.css" rel="stylesheet" media="print" />

        </head> <!-- end : head -->
<body class="page-plugin project-cpf-parent anchorjs-enabled scrolltop-smooth-enabled m-toc-top-enabled">
    <nav id="m-top-navbar" class="navbar navbar-expand-lg fixed-top navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand mb-0 h1" href=".">
                <span class="color-highlight">CPF</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-collapse-1" aria-controls="top-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item dropdown active">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="index.html" title="About"  class="dropdown-item ">About</a>
                             <a href="install.html" title="Installation"  class="dropdown-item ">Installation</a>
                             <a href="" title="Plug-in Developer Guide"  class="dropdown-item active">Plug-in Developer Guide</a>
                             <a href="client.html" title="Client Developer Guide"  class="dropdown-item ">Client Developer Guide</a>
                             <a href="admin.html" title="Administrator Guide"  class="dropdown-item ">Administrator Guide</a>
                             <div class="dropdown-submenu">
<a     
     title="Reference"  class="dropdown-item" >Reference</a>                                <div class="dropdown-menu">
                                    <a href="reference/maven.html" title="Maven"  class="dropdown-item ">Maven</a>
                                    <a href="reference/authentication.html" title="Authentication"  class="dropdown-item ">Authentication</a>
                                    <a href="reference/dataTypes.html" title="Data Types"  class="dropdown-item ">Data Types</a>
                                    <a href="reference/fileFormats.html" title="File Formats"  class="dropdown-item ">File Formats</a>
                                    <a href="reference/resourceDescription.html" title="Resource Description"  class="dropdown-item ">Resource Description</a>
                                    <a href="reference/jobStatus.html" title="Job Status"  class="dropdown-item ">Job Status</a>
                                    <a href="reference/structuredData.html" title="Structured Data"  class="dropdown-item ">Structured Data</a>
                                    <a href="reference/opaqueData.html" title="Opaque Data"  class="dropdown-item ">Opaque Data</a>
                                </div>
                            </div>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Modules <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="cpf-api-plugin/index.html" title="Concurrent Processing Framework Business Application Plugin API"  class="dropdown-item ">Concurrent Processing Framework Business Application Plugin API</a>
                             <a href="cpf-api-client/index.html" title="Concurrent Processing Framework Client Java API"  class="dropdown-item ">Concurrent Processing Framework Client Java API</a>
                             <a href="cpf-api-app/index.html" title="Concurrent Processing Framework Application Java API"  class="dropdown-item ">Concurrent Processing Framework Application Java API</a>
                             <a href="cpf-api-worker/index.html" title="Concurrent Processing Framework API Worker"  class="dropdown-item ">Concurrent Processing Framework API Worker</a>
                             <a href="cpf-war-app/index.html" title="Concurrent Processing Framework Base WAR Web Application"  class="dropdown-item ">Concurrent Processing Framework Base WAR Web Application</a>
                             <a href="cpf-war-worker/index.html" title="Concurrent Processing Framework Base WAR Worker"  class="dropdown-item ">Concurrent Processing Framework Base WAR Worker</a>
                             <a href="cpf-archetype-plugin/index.html" title="CPF Plug-in Maven Arechtype"  class="dropdown-item ">CPF Plug-in Maven Arechtype</a>
                             <a href="cpf-archetype-web/index.html" title="Concurrent Processing Framework Archetype Web"  class="dropdown-item ">Concurrent Processing Framework Archetype Web</a>
                             <a href="plugins/test/index.html" title="CPF Test Plugins"  class="dropdown-item ">CPF Test Plugins</a>
                             <a href="plugins/digest/index.html" title="Digest Plug-in"  class="dropdown-item ">Digest Plug-in</a>
                             <a href="plugins/geometry-validation/index.html" title="Geometry Validation Plug-in"  class="dropdown-item ">Geometry Validation Plug-in</a>
                             <a href="plugins/mandelbrot/index.html" title="Mandelbrot Plug-in"  class="dropdown-item ">Mandelbrot Plug-in</a>
                             <a href="plugins/map-tile/index.html" title="Map Tile Plug-in"  class="dropdown-item ">Map Tile Plug-in</a>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="https://github.com/revolsys/cpf/" title="GitHub Project"  class="dropdown-item ">GitHub Project</a>
                             <a href="https://github.com/revolsys/cpf/issues/" title="Issues (GitHub)"  class="dropdown-item ">Issues (GitHub)</a>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Links <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="https://www2.gov.bc.ca" title="Province of British Columbia" target="_blank" class="dropdown-item ">Province of British Columbia</a>
                             <a href="https://bcdevexchange.org/" title="BC Developer Exchange" target="_blank" class="dropdown-item ">BC Developer Exchange</a>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Maven documentation <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <div class="dropdown-submenu">
<a     
     href="project-info.html"  title="Project Information"  class="dropdown-item" >Project Information</a>                                <div class="dropdown-menu">
                                    <a href="dependency-convergence.html" title="Dependency Convergence"  class="dropdown-item ">Dependency Convergence</a>
                                    <a href="dependency-info.html" title="Dependency Information"  class="dropdown-item ">Dependency Information</a>
                                    <a href="dependency-management.html" title="Dependency Management"  class="dropdown-item ">Dependency Management</a>
                                    <a href="distribution-management.html" title="Distribution Management"  class="dropdown-item ">Distribution Management</a>
                                    <a href="index.html" title="About"  class="dropdown-item ">About</a>
                                    <a href="issue-management.html" title="Issue Management"  class="dropdown-item ">Issue Management</a>
                                    <a href="licenses.html" title="Licenses"  class="dropdown-item ">Licenses</a>
                                    <a href="modules.html" title="Project Modules"  class="dropdown-item ">Project Modules</a>
                                    <a href="plugin-management.html" title="Plugin Management"  class="dropdown-item ">Plugin Management</a>
                                    <a href="plugins.html" title="Plugins"  class="dropdown-item ">Plugins</a>
                                    <a href="scm.html" title="Source Code Management"  class="dropdown-item ">Source Code Management</a>
                                    <a href="summary.html" title="Summary"  class="dropdown-item ">Summary</a>
                                    <a href="team.html" title="Team"  class="dropdown-item ">Team</a>
                                </div>
                            </div>
                             <div class="dropdown-submenu">
<a     
     href="project-reports.html"  title="Project Reports"  class="dropdown-item" >Project Reports</a>                                <div class="dropdown-menu">
                                    <a href="apidocs/index.html" title="Javadoc"  class="dropdown-item ">Javadoc</a>
                                </div>
                            </div>
                          </div>
                    </li>
                   </ul><!--/ul.navbar-nav -->
            </div><!--/.nav-collapse -->
        </div> <!--/.container -->
    </nav> <!--/.navbar -->
    <div class="main-body container-fuild my-3">
    <div class="row m-0">
        <div class="d-xs-none d-sm-none d-md-none d-lg-block col-lg-2">
        </div>
        <main class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-8" role="main">
            <div class="header container-fluid">
                      <div class="jumbotron subhead">
        <div class="row m-1" id="banner">
          <div class="col-md-12">
            <div class="float-left bannerLeft">
                                  <div class="bannerLeft">
            <h1>Concurrent Processing Framework</h1>
            </div>
            </div>
            <div class="float-right bannerRight">
                                  <a href="https://www2.gov.bc.ca">
            <img class="float-left m-2 img-fluid" src="images/bc_sun_logo_horiz.gif"  />
            <h1>Province of British Columbia</h1>
            </a>
            </div>
          </div>
        </div>
      </div>
                     <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a     
     href="."  title="CPF"  class="" >CPF</a></li>
            <li class="breadcrumb-item active">Plug-in Guide</li>
        </ol>
    </nav>
            </div> <!-- end : header -->
                    <hr class="toc-separator" />
    <div id="m-toc-topbar" class="navbar navbar-expand-lg navbar-light bg-light">
      <div id="toc-scroll-target">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#m-toc-topnav-collapse" aria-controls="m-toc-topnav-collapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        <div id="m-toc-topnav-collapse" class="collapse navbar-collapse">
            <ul id="m-toc-topnav" class="navbar-nav">
                                                            <li class="nav-item toplevel"><a class="nav-link" href="#plug-in_guide1" title="Plug-in Guide">Plug-in Guide</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Overview" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Overview</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#overview1" title="Overview">Overview</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#api__download" title="API & Download">API & Download</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Maven Project" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Maven Project</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#maven_project1" title="Maven Project">Maven Project</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#create_a_plug-in_project1" title="Create a plug-in project">Create a plug-in project</a>
                <a class="dropdown-item" href="#add_dependencies1" title="Add Dependencies">Add Dependencies</a>
                <a class="dropdown-item" href="#jdbc_dependencies1" title="JDBC Dependencies">JDBC Dependencies</a>
                <a class="dropdown-item" href="#build_the_plug-in1" title="Build the plug-in">Build the plug-in</a>
                <a class="dropdown-item" href="#deploy_a_plug-in1" title="Deploy a Plug-in">Deploy a Plug-in</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Business Application Class" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Business Application Class</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#business_application_class1" title="Business Application Class">Business Application Class</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#java_class1" title="Java Class">Java Class</a>
                <a class="dropdown-item" href="#plug-in_spring_configuration_file1" title="Plug-in Spring Configuration File">Plug-in Spring Configuration File</a>
                <a class="dropdown-item" href="#plug-in_resource_beans1" title="Plug-in Resource Beans">Plug-in Resource Beans</a>
                <a class="dropdown-item" href="#plug-in_job_parameters__structured_request_paramet" title="Plug-in Job Parameters & Structured Request Parameters">Plug-in Job Parameters & Structured Request Parameters</a>
                <a class="dropdown-item" href="#per_request_input_data1" title="Per request input data">Per request input data</a>
                <li class="dropdown-submenu">
                    <a href="#structured_result_attributes1" title="Structured Result Attributes">Structured Result Attributes</a>
                    <div class="dropdown-menu" role="menu">
                <a class="dropdown-item" href="#list_of_structured_result_attributes1" title="List of Structured Result Attributes">List of Structured Result Attributes</a>
                    </div>
                </li>
                <a class="dropdown-item" href="#structured_data_geometry_request_parameters_and_re" title="Structured Data Geometry Request Parameters and Result Attributes">Structured Data Geometry Request Parameters and Result Attributes</a>
                <a class="dropdown-item" href="#geometry_job__request_parameters" title="Geometry Job & Request Parameters">Geometry Job & Request Parameters</a>
                <li class="dropdown-submenu">
                    <a href="#geometry_result_attributes1" title="Geometry Result Attributes">Geometry Result Attributes</a>
                    <div class="dropdown-menu" role="menu">
                <a class="dropdown-item" href="#geometry_processing1" title="Geometry Processing">Geometry Processing</a>
                    </div>
                </li>
                <a class="dropdown-item" href="#per_request_result_data1" title="Per request result data">Per request result data</a>
                <a class="dropdown-item" href="#execute_method1" title="Execute method">Execute method</a>
                <a class="dropdown-item" href="#logging1" title="Logging">Logging</a>
                <a class="dropdown-item" href="#memory_management1" title="Memory Management">Memory Management</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Customization" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Customization</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#customization1" title="Customization">Customization</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#defining_customization_properties1" title="Defining Customization Properties">Defining Customization Properties</a>
                <a class="dropdown-item" href="#form_customization_properties1" title="Form Customization Properties">Form Customization Properties</a>
                <a class="dropdown-item" href="#result_file_customization_properties1" title="Result File Customization Properties">Result File Customization Properties</a>
                            </div>
                        </li>
                        <li class="nav-item toplevel"><a class="nav-link" href="#configuration1" title="Configuration">Configuration</a></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Security" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Security</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#security1" title="Security">Security</a>
                                <div class="dropdown-divider"></div>
                                              <li class="dropdown-submenu">
                    <a href="#security_groups1" title="Security Groups">Security Groups</a>
                    <div class="dropdown-menu" role="menu">
                <a class="dropdown-item" href="#user_type1" title="User type">User type</a>
                <a class="dropdown-item" href="#global1" title="Global">Global</a>
                <a class="dropdown-item" href="#plug-in_groups1" title="Plug-in Groups">Plug-in Groups</a>
                    </div>
                </li>
                <a class="dropdown-item" href="#security_permissions1" title="Security Permissions">Security Permissions</a>
                <a class="dropdown-item" href="#security_configuration_file1" title="Security Configuration File">Security Configuration File</a>
                <a class="dropdown-item" href="#business_application_permissions1" title="Business Application Permissions">Business Application Permissions</a>
                <a class="dropdown-item" href="#request_level_security1" title="Request Level Security">Request Level Security</a>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Testing" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Testing</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#testing1" title="Testing">Testing</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#cpf_web_site1" title="CPF Web Site">CPF Web Site</a>
                <a class="dropdown-item" href="#test_harness1" title="Test Harness">Test Harness</a>
                            </div>
                        </li>
            </ul>
        </div>
      </div> <!-- .container -->
    </div> <!-- end: m-toc-topbar -->
                 <section> 
 <div class="page-header">
  <h2 id="plug-in_guide1">Plug-in Guide</h2>
 </div> 
 <p>The Concurrent Processing Framework (CPF) Plug-in Developers Guide provides instructions for developers to be able to develop and test CPF plug-in modules containing business application plug-ins in their environment and to deliver them to the ministry.</p> 
 <p>See the Plug-in links in the menu on the left of this page for more details on developing a plug-in.</p> 
 <section> 
  <h3 id="overview1">Overview</h3> 
  <p>A CPF Plug-in module is a Maven project that contains one or more business application plug-ins. A business application plug-in is a service that takes one or more request parameters, performs an action using the request parameters and generates one or more result attributes. The CPF allows a user to create a job that contains one or more requests to be executed against a single business application. For example a job may contain 1 million addresses to geocode.</p> 
  <p>For an example a power service would have the request parameters <code>base</code> and <code>exponent</code> and the result attribute <code>result</code>, which is the calculation of base to the power of exponent.</p> 
  <p>For input parameters a plug-in can accept either one or more structured request attributes or a per request input data with an InputStream containing an opaque blob of data.</p> 
  <ul> 
   <li>Structured request attributes can be thought of as a key value pair map of values. The users of the plug-in can specify a single file (e.g. CSV, JSON) with a record containing the values for each request to be executed by the plug-in. For example each address to geocode would have one record in the input file and the new instance plug-in will be executed for each record. In addition to request level parameters there are also job parameters that apply to all requests in the job. The CPF will convert the input data from the file format specified by the user to Java objects for use by the plug-in.</li> 
   <li>Per request input data is used where the data is more complex than key value pairs, or is a binary blob of data. Each request is specified using a separate file stream or URL to the binary blob of data. For example a face detection plug-in would take a JPEG file as an input parameter for each face to recognize. Per request input data plug-ins cannot also have request attributes, although they may have job attributes. If structured request attributes and binary blobs are required for the same plug-in the plug-in can accept a URL to the input data and process that URL within the plug-in.</li> 
  </ul> 
  <p>For result fields the plug-in can either return a single record of structured result data, a list of structured result data or a single binary blob of data.</p> 
  <ul> 
   <li>Like structured request attributes structured result attributes are a key value pairs. The CPF will create a single file in the requested output file for the user to download with one record for each result returned from the plug-in.</li> 
   <li>The list of structured results also creates a single output file for the user to download. There will be one record for each entry in the list of results, with a relative result number showing the order of the result in the list of results.</li> 
   <li>Like per request input data, per request result data returns one binary blob of data for each request. There will be one file for the user to download for each request. For example a WMS service would return a JPEG, or PNG for each map to render.</li> 
  </ul> 
  <p>The CPF and plug-ins depend heavily on the <a class="externalLink" href="https://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/">Spring Framework</a> and the XML configuration mechanism. Developers should have a least a basic understanding of defining spring beans and dependency injection.</p> 
  <section> 
   <h4 id="api__download">API &amp; Download</h4> 
   <p>The most recent version of the CPF is ${project.version}. For development purposes the most recent snapshot version of the CPF libraries and the trunk sub-tree in the subversion repository should be used. The snapshot and the trunk are only updated under controlled circumstances when new functionality or bug fixes are to be delivered to the plug-in developers. When delivering a final version of the application to the Ministry the plug-in must use the same version as is deployed to the Ministry’s server.</p> 
   <p>Use the links in the following table to view the Plug-in API documentation or download the API libraries.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>API</th> 
       <th>Documentation</th> 
       <th>Download</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td>Plug-in Java (11+)</td> 
       <td><a href="java-api">API Docs</a></td> 
       <td><a href="../../lib/cpf-api-plugin-${project.version}.jar">Download</a></td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
  </section> 
 </section> 
 <section> 
  <h3 id="maven_project1">Maven Project</h3> 
  <p>The CPF uses maven modules for the deployment of plug-in modules to the CPF web services. Each CPF plug-in module is a maven project that contains all the code and dependencies of the plug-in. Within the CPF plug-in module one or more <a href="#Business_Application_Class">Business Application Class</a> implementations can be defined.</p> 
  <section> 
   <h4 id="create_a_plug-in_project1">Create a plug-in project</h4> 
   <p>The first step is to create a plug-in project. Plug-ins must be developed using Apache Maven 3.0.x.</p> 
   <p>A new plug-in project can be created using the Maven archetype mechanism. The archetype defines a template project that can be created by passing in parameters to the following command.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>cd ~/projects
mvn \
&nbsp;&nbsp;archetype:generate \
&nbsp; -DinteractiveMode=false \
&nbsp; -DarchetypeGroupId=ca.bc.gov.open.cpf \
&nbsp; -DarchetypeArtifactId=cpf-archetype-plug-in \
&nbsp;&nbsp;-DarchetypeVersion=${project.version} \
&nbsp;&nbsp;-DgroupId=ca.bc.gov \
&nbsp; -DartifactId=demo \
&nbsp; -Dversion=1.0.0-SNAPSHOT \
&nbsp;&nbsp;-Dpackage=ca.bc.gov.demo \
&nbsp;&nbsp;-Dplug-inName=Demo \
&nbsp;&nbsp;-Dplug-inAcronym=demo
</pre> 
    </div> 
   </div> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Parameter</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td><code>archetypeVersion</code></td> 
       <td>The most recent version of the CPF framework.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>groupId</code></td> 
       <td>The maven group identifier also used as the java package name for the plug-in class. For BC Government plug-ins this should be ca.bc.gov.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>artifactId</code></td> 
       <td>The base maven artifact identifier used for the maven modules created in the project. This should be the project acronym for BC Government projects.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>version</code></td> 
       <td>The version identifier you’d like to give to your plug-in. Must include -SNAPSHOT the -SNAPSHOT is removed on migration to test and production.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>package</code></td> 
       <td>The Java package name for the generated code. Must be <code>ca.bc.gov.{acronym}</code> for BC Government projects.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>pluginName</code></td> 
       <td>The name of the plug-in. This will be used to generate the plug-in class name and for descriptions in the Maven build files.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>pluginAcronym</code></td> 
       <td>The acronym of the plug-in. This will be used to generate the plug-in jar name.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
   <p>The following directory structure would be created if the command were run using the parameters above.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>File/Directory</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td><code>demo/</code></td> 
       <td>The root directory of the plug-in project.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>&nbsp;&nbsp;scripts/</code></td> 
       <td>Any SQL scripts required to create the database or data required by the plug-in. Samples are included.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>&nbsp;&nbsp;README.txt</code></td> 
       <td>A sample readme file for deployment to the Ministry. Edit for your application.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>&nbsp;&nbsp;pom.xml</code></td> 
       <td>The maven build file for the plug-in.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>&nbsp;&nbsp;src/</code></td> 
       <td>The root folder containing the source code and resources.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>&nbsp;&nbsp;&nbsp;&nbsp;main/java/ca.bc.gov/demo/</code></td> 
       <td>The java package for the plug-in, add any support classes in here.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DemoPlug-in.java</code></td> 
       <td>The java class for the plug-in.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>&nbsp;&nbsp;&nbsp;&nbsp;main/resources/</code></td> 
       <td>The non-java resource files to include in the plug-in jar.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;META-INF/</code></td> 
       <td>The META-INF directory for the plug-in jar.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ca.bc.gov.open.cpf.plugin.sf.xml</code></td> 
       <td>The main CPF spring configuration file for the plug-ins in this module.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ca/bc/gov/demo/Demo.sf.xml</code></td> 
       <td>The spring configuration file containing any beans used by the plug-ins.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
  </section> 
  <section> 
   <h4 id="add_dependencies1">Add Dependencies</h4> 
   <p>A plug-in can include dependencies to additional libraries that are not deployed as part of the core CPF application. These must be approved prior to delivering to the Ministry.</p> 
   <p>All plug-ins must either be available in the <a class="externalLink" href="https://search.maven.org/">Maven central repository</a>. Or a private repository that the CPF is configured to access.</p> 
   <p>If any of the dependencies include dependencies to logging frameworks such as Logback, LOG4J, SLF4J and especially commons-logging these must be <a class="externalLink" href="https://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html#Dependency_Exclusions">excluded</a> from those dependencies. This ensures that carefully controlled versions of these files are used. The CPF internally uses SLF4J as the logging API with a Logback binding to perform the actual logging and a bridge so that commons logging is logged via SLF4J. It is recommended for plug-ins to use SLF4J for logging in their module. Plug-ins must not include a <code>log4j.xml</code>, or <code>log4j2.xml</code>, or <code>logback.xml</code> file in their Jar file. They can however be included in <code>src/test/resources</code> for testing the plug-in.</p> 
   <p>Any dependencies that are included in the CPF application itself must be marked with a scope of <code>provided</code>. If they are dependencies of other modules then they should be excluded from that dependency. CPF ignores any dependencies to the CPF libraries or the libraries it uses. This ensures that the correct versions of these libraries are used at runtime.</p> 
   <p>Any dependencies to test frameworks such as junit must be included using the <code>test</code> scope so that they are not included in the jar. Also any test code must be included below <code>src/test</code> as opposed to <code>src/main</code>.</p> 
  </section> 
  <section> 
   <h4 id="jdbc_dependencies1">JDBC Dependencies</h4> 
   <p>The CPF supports the Oracle and PostgreSQL with PostGIS extensions JDBC drivers. The dependencies to these drivers are included through the <code>cpf-api-plugin</code> dependency.</p> 
   <blockquote> 
    <p><b>NOTE:</b> At this time no other versions of these JDBC drivers or 3rd party JDBC drivers are supported. Any dependencies to those drivers must be excluded from the plug-in’s dependencies. Other JDBC driver versions may interfere with the running of the CPF application.</p> 
   </blockquote> 
  </section> 
  <section> 
   <h4 id="build_the_plug-in1">Build the plug-in</h4> 
   <p>The plug-in is built using maven. Use the following command to create a clean build that is deployed to your local maven repository.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>mvn clean install
</pre> 
    </div> 
   </div> 
   <p>The plug-in must be deployed to a maven repository so that the CPF can download the plug-in. If on a developers workstation a local maven cache can be used instead of this step.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>mvn deploy
</pre> 
    </div> 
   </div> 
  </section> 
  <section> 
   <h4 id="deploy_a_plug-in1">Deploy a Plug-in</h4> 
   <p>Plug-ins are deployed dynamically using the CPF admin application. Follow this procedure to deploy a new module.</p> 
   <ol style="list-style-type: decimal"> 
    <li>Open the CPF modules admin page.</li> 
    <li>Click the Add button on the Modules page.</li> 
    <li>Enter the project acronym as the module name (e.g. DEMO), it will be converted to upper case.</li> 
    <li>Enter in the maven module Id for your plug-in in the format <code>{groupId}:{artifactId}:{version}</code>. For example <code>com.myapplication:demo:1.0.0-SNAPSHOT</code>.</li> 
    <li>Click the Save button</li> 
    <li>The module view page will be displayed.</li> 
   </ol> 
   <p>If the version number of a module changes, follow this procedure to update the version for an existing module.</p> 
   <ol style="list-style-type: decimal"> 
    <li>Open the CPF modules admin page.</li> 
    <li>Click on the name of the module in the table, this will open the module view page.</li> 
    <li>Click on the name of the module in the table, this will open the module view page.</li> 
    <li>Click Edit button to edit the module.</li> 
    <li>Enter in the maven module Id for your plug-in in the format <code>{groupId}:{artifactId}:{version}</code>. For example <code>com.myapplication:demo:1.0.0-SNAPSHOT</code>.</li> 
    <li>Click the Save button</li> 
    <li>The module view page will be displayed.</li> 
    <li>Click the restart button to load the new version of the module.</li> 
   </ol> 
   <blockquote> 
    <p><b>NOTE:</b> You cannot change the name of the module. Delete the existing module and create a new one.</p> 
   </blockquote> 
  </section> 
 </section> 
 <section> 
  <h3 id="business_application_class1">Business Application Class</h3> 
  <section> 
   <h4 id="java_class1">Java Class</h4> 
   <p>A business application plug-in is implemented as a Java class with the <a href="cpf-api-plugin/java-api/#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin">BusinessApplicationPlugin</a> annotation. See <a href="cpf-api-plugin/java-api/#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin">BusinessApplicationPlugin</a> for details of the annotation elements that can be used to configure the business application.</p> 
   <p>A single plug-in module can have more than one plug-in class, one for each plug-in provided by that module.</p> 
  </section> 
  <section> 
   <h4 id="plug-in_spring_configuration_file1">Plug-in Spring Configuration File</h4> 
   <p>The CPF business application plug-in classes are registered with the CPF by including the plug-in definition spring file <code>src/main/resources/META-INF/ca.bc.gov.open.cpf.plugin.sf.xml</code> in the Maven project.</p> 
   <p>The following file shows an example of this file.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
&nbsp; xmlns="http://www.springframework.org/schema/beans"
&nbsp; xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&nbsp; xmlns:util="http://www.springframework.org/schema/util"
&nbsp; xmlns:p="http://www.springframework.org/schema/p"
&nbsp; xsi:schemaLocation="
    http://www.springframework.org/schema/beans
    https://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/util
    https://www.springframework.org/schema/util/spring-util.xsd
&nbsp; "
&gt;
&nbsp; &lt;util:list id="beanImports"&gt;
&nbsp;  &lt;value&gt;classpath:/ca/bc/gov/demo/Demo.sf.xml&lt;/value&gt;
&nbsp; &lt;/util:list&gt;

&nbsp; &lt;bean
&nbsp;  id="demo"
&nbsp;  class="ca.bc.gov.demo.DemoPlug-in"
&nbsp;  p:dataSource-ref="demoDataSource"
&nbsp;  scope="prototype" /&gt;
&lt;/beans&gt;
</pre> 
    </div> 
   </div> 
   <p>This file may only contain bean definitions for the plug-ins and an optional <b>beanImports</b> list.</p> 
   <p>The bean definitions must have the id attribute equal to the business application plug-in name defined in the plug-in class. The class must be the fully qualified class name of the plug-in class. The scope on the bean must be set to prototype. This ensures that a new instance of the plug-in be created on each request to get the bean. The <a class="externalLink" href="https://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-p-namespace">p:{propertyName}</a> or <a class="externalLink" href="https://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-p-namespace">p:{propertyName}-ref</a> attribute styles can be used to inject dependencies into the bean when it is created.</p> 
   <p>If the plug-in requires other beans such as JDBC data sources or a caching service that are expensive to create these must be defined in plug-in resource spring configuration files. The plug-in archetype includes a blank spring file for this purpose. The <code>beanImports</code> list includes a reference to each plug-in resource spring file used by the plug-ins. This is used instead of the spring <code>import</code> mechanism so that the beans defined in those files are only instantiated on the worker nodes. Within the plug-in definition spring file no regular spring imports can be used, spring imports can however be used in the plug-in resource spring files. Additional <code>beanImports</code> can be added if required.</p> 
  </section> 
  <section> 
   <h4 id="plug-in_resource_beans1">Plug-in Resource Beans</h4> 
   <p>A new instance of the plug-in class is created for each request processed in a job. Therefore the plug-in class should not perform any complex instantiation in the constructor. Instead any resources (such as data sources) or a caching service should be defined as singleton beans in the plug-in resource spring files.</p> 
   <p>The plug-in bean will have a property (set/get method pair) for each resource bean it uses.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>private DataSource dataSource;

private void setDataSource(DataSource dataSource) {
&nbsp; this.dataSource = dataSource;
}

private DataSource getDataSource() {
&nbsp; return dataSource;
}
</pre> 
    </div> 
   </div> 
   <p>The ca/bc/gov/demo/Demo.sf.xml plug-in resource spring file would define the bean as shown below.</p> 
   <blockquote> 
    <p><b>NOTE:</b> this example introduces the <code>JdbcDataSourceFactoryBean</code>. This can be used to create a pooling data source without needing to know the underlying database data source used. By changing the URL to an Oracle JDBC URL it will create an Oracle data source. The config properties are set on the data source instance. Consult the database vendor’s documentation for the available parameters.</p> 
   </blockquote> 
   <div class="source"> 
    <div class="source"> 
     <pre>&lt;bean
&nbsp;&nbsp;id="demoDataSource"
&nbsp; class="com.revolsys.jdbc.io.JdbcDataSourceFactoryBean"
&nbsp; p:url="jdbc:postgresql://localhost:5432/demo"
&nbsp; p:username="demo"
&nbsp; p:password="12345678"
&gt;
&nbsp; &lt;property
&nbsp;  name="config"
&nbsp; &gt;
&nbsp;  &lt;map&gt;
&nbsp;&nbsp;&nbsp;  &lt;entry
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  key="initialConnections"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  value="0" /&gt;
&nbsp;&nbsp;&nbsp;  &lt;entry
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  key="maxConnections"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  value="10" /&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/map&gt;
&nbsp; &lt;/property&gt;
&lt;/bean&gt;
</pre> 
    </div> 
   </div> 
   <blockquote> 
    <p>*<i>NOTE:</i> Beans should not be defined with <code>lazy-init="true"</code>. This will cause the system to think the plug-in has been loaded when not all beans are ready. This can cause worker threads to be blocked waiting for the beans to initialize.</p> 
   </blockquote> 
   <p>Finally the demoDataSource bean will be injected into the <code>dataSource</code> property on the <code>demo</code> bean definition in the plug-in definition spring file.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
&nbsp; xmlns="http://www.springframework.org/schema/beans"
&nbsp; xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&nbsp; xmlns:util="http://www.springframework.org/schema/util"
&nbsp; xmlns:p="http://www.springframework.org/schema/p"
&nbsp; xsi:schemaLocation="
&nbsp;   http://www.springframework.org/schema/beans
&nbsp;   https://www.springframework.org/schema/beans/spring-beans.xsd
&nbsp;   http://www.springframework.org/schema/util
&nbsp;   https://www.springframework.org/schema/util/spring-util.xsd
&nbsp; "
&gt;
&nbsp; &lt;util:list id="beanImports"&gt;
&nbsp;  &lt;value&gt;classpath:/com/mycompany/demo/Demo.sf.xml&lt;/value&gt;
&nbsp; &lt;/util:list&gt;

  &lt;bean
&nbsp;  id="demo"
&nbsp;  class="ca.bc.gov.demo.DemoPlug-in"
&nbsp;  p:dataSource-ref="demoDataSource"
&nbsp;  scope="prototype" /&gt;
&lt;/beans&gt;
</pre> 
    </div> 
   </div> 
   <p>Any required dependencies can be injected using the basic approach shown above.</p> 
  </section> 
  <section> 
   <h4 id="plug-in_job_parameters__structured_request_paramet">Plug-in Job Parameters &amp; Structured Request Parameters</h4> 
   <p>A plug-in can implement parameters that the user can specify when submitting a job. Parameters can be global for all the requests in a job using the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.JobParameter">JobParameter</a> annotation. Parameters for <a href="reference/structuredData.html">structured input data</a> plug-ins with <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.perRequestInputData">perRequestInputData</a>=false must have parameters specific to an individual request within the job using the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.RequestParameter">RequestParameter</a> annotation.</p> 
   <p>Parameter methods can also have the following annotations.</p> 
   <ul> 
    <li><a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.AllowedValues">ca.bc.gov.open.cpf.plugin.api.AllowedValues</a></li> 
    <li><a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.DefaultValue">ca.bc.gov.open.cpf.plugin.api.DefaultValue</a></li> 
    <li><a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.GeometryConfiguration">ca.bc.gov.open.cpf.plugin.api.GeometryConfiguration</a></li> 
    <li><a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.Required">ca.bc.gov.open.cpf.plugin.api.Required</a></li> 
   </ul> 
  </section> 
  <section> 
   <h4 id="per_request_input_data1">Per request input data</h4> 
   <p><a href="reference/opaqueData.html">Opaque input data</a> plug-ins with <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.perRequestInputData">perRequestInputData</a>=true must implement the following methods to set the content type of the binary blob and URL which can be used to access the binary blob of the input data for that request. The input stream for the URL can be read in the execute method of the plug-in. When getting the input stream for the URL any HTTP redirects must be followed to get the final content to read.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>private URL inputDataUrl;

private String inputDataContentType;

public void setInputDataUrl(final URL inputDataUrl) {
&nbsp; this.inputDataUrl = inputDataUrl;
}

public void setInputDataContentType (final String inputDataContentType) {
&nbsp; this.inputDataContentType = inputDataContentType;
}
</pre> 
    </div> 
   </div> 
  </section> 
  <section> 
   <h4 id="structured_result_attributes1">Structured Result Attributes</h4> 
   <p><a href="reference/structuredData.html">Structured result data</a> plug-ins with <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.perRequestResultData">perRequestInputData</a>=false must implement result data properties using the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.ResultAttribute">ResultAttribute</a> annotation for more details.</p> 
   <p>Parameter methods can also have the following annotations.</p> 
   <ul> 
    <li><a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.GeometryConfiguration">ca.bc.gov.open.cpf.plugin.api.GeometryConfiguration</a></li> 
   </ul> 
   <section> 
    <h5 id="list_of_structured_result_attributes1">List of Structured Result Attributes</h5> 
    <p><a href="reference/structuredData.html">Structured result data</a> plug-ins can use the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.ResultList">ResultList</a> annotation to return multiple results from a single request.</p> 
   </section> 
  </section> 
  <section> 
   <h4 id="structured_data_geometry_request_parameters_and_re">Structured Data Geometry Request Parameters and Result Attributes</h4> 
   <p>The CPF includes spatial support for structured input data and result data files. This enables plug-ins to define job parameters, request parameters and result attributes to use <a class="externalLink" href="http://tsusiatsoftware.net/jts/main.html">Java Topology Suite</a> (JTS) Geometry objects. The CPF reads the input data files (e.g. Shapefile (ESRI) in a Zip file) and converts the values into JTS Geometry objects for processing by the business application. After processing the JTS Geometry objects are converted back into the requested output spatial file format. The CPF also handles projection of the geometries if required.</p> 
   <p>The CPF can use <a class="externalLink" href="https://en.wikipedia.org/wiki/Well-known_text">Well-known_text</a> (WKT) and <a class="externalLink" href="https://postgis.org/documentation/manual-1.5/ch04.html#EWKB_EWKT">Extended WKT</a> (EWKT) geometry strings for geometries in the input data files submitted by the user or the result data files generated by the CPF. This can be used in non-spatial file formats or where there are multiple geometries in a spatial file format that only supports a single geometry. These EWKT geometries will be converted to JST Geometry objects. EWKT geometries are also used for job parameters as they are passed as HTML form parameters. We however don’t recommend using geometries as job parameters.</p> 
  </section> 
  <section> 
   <h4 id="geometry_job__request_parameters">Geometry Job &amp; Request Parameters</h4> 
   <p>Adding a geometry job parameter or request parameter is exactly the same as any other business application parameter. The parameter type must be a JTS Geometry class or subclass. The only difference is that the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.GeometryConfiguration">GeometryConfiguration</a> annotation can also be specified. If the configuration is not set on the method then the annotation from the class is used.</p> 
  </section> 
  <section> 
   <h4 id="geometry_result_attributes1">Geometry Result Attributes</h4> 
   <p>Adding a geometry result attribute is exactly the same as any other business application result attributes. The return type must be a JTS Geometry class or subclass. The only difference is that the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.GeometryConfiguration">GeometryConfiguration</a> annotation can also be specified. If the configuration is not set on the method then the annotation from the class is used.</p> 
   <blockquote> 
    <p><b>NOTE:</b> All geometries created by a business application must have the SRID set on the geometry object.</p> 
   </blockquote> 
   <p>The user when creating a job can override the srid, numAxis, scaleFactorXy and scaleFactorZ. The required conversion will be performed by the CPF. The business application can implement any one of the following methods to receive the values requested by the user. This might be useful if the application wants to perform it’s own projection or reduce work by not creating z-values if they are not required.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>public void setResultNumAxis(final int resultNumAxis) {
&nbsp; this.resultNumAxis = resultNumAxis;
}

public void setResultScaleFactorXy(final double resultScaleFactorXy) {
&nbsp; this.resultScaleFactorXy = resultScaleFactorXy;
}

public void setResultScaleFactorZ(final double resultScaleFactorZ) {
&nbsp;&nbsp;this.resultScaleFactorZ = resultScaleFactorZ;
}

public void setResultSrid(final int resultSrid) {
&nbsp;  this.resultSrid = resultSrid;
}
</pre> 
    </div> 
   </div> 
   <section> 
    <h5 id="geometry_processing1">Geometry Processing</h5> 
    <p>See the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.GeometryFactory">GeometryFactory</a> class for details on creating <a class="externalLink" href="http://tsusiatsoftware.net/jts/main.html">Java Topology Suite</a> (JTS) geometry objects.</p> 
   </section> 
  </section> 
  <section> 
   <h4 id="per_request_result_data1">Per request result data</h4> 
   <p><a href="reference/opaqueData.html">Opaque input data</a> plug-ins with <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.perRequestResultData">perRequestResultData</a>=true cannot return result attributes. They can only return the binary content of the result data. The plug-in must implement the following methods. The <code>resultData</code> output stream can be used to write the result binary blob data. The <code>resultDataContentType</code> indicates to the plug-in the type of result data it should generate.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>private OutputStream resultData;

private String resultDataContentType;

public void setResultData(final OutputStream resultData) {
  this.resultData = resultData;
}

public void setResultDataContentType(final String format) {
  this.resultDataContentType = format;
}
</pre> 
    </div> 
   </div> 
  </section> 
  <section> 
   <h4 id="execute_method1">Execute method</h4> 
   <p>The plug-in must implement a public void <code>execute()</code> method. When the CPF has set all the parameters on the plug-in it invokes the execute method so that the plug-in can perform the request using the parameters and generate the result.</p> 
   <p>The following is a simple example of an execute method that takes the value request field, calculates the square and stores this in the square result attribute.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>public void execute() {
  this.square = this.value * this.value;
}
</pre> 
    </div> 
   </div> 
   <p>The following is an example of a per request input data execute method. The plug-in gets the input stream from the inputDataUrl, performs some processing on the data and stores the result in the digest result attribute.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>public void execute() {
  try {
    MessageDigest digester = MessageDigest.getInstance("MD5");
    InputStream in = this.inputDataUrl.openStream();
    byte[] buffer = new byte[4096];
    for (int count = in.read(buffer); count != -1; count = in.read(buffer)) {
  &nbsp;    digester.update(buffer, 0, count);
  &nbsp;  }
    byte[] data = digester.digest();
    this.digest = new String(Hex.encodeHex(data));
  } catch (NoSuchAlgorithmException e) {
    throw new IllegalArgumentException("Cannot find digest algorithm " + algorithmName, e);
  } catch (IOException e) {
    throw new RuntimeException("Cannot read input data", e);
  }
}
</pre> 
    </div> 
   </div> 
   <p>The following is an example of a per request result data execute method. The plug-in creates query string parameters from the plug-in request parameters and creates a connection to a web service. The plug-in then writes the response from the web service to the result data.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>public void execute() {
&nbsp; Map&lt;String, Object&gt; parameters = new LinkedHashMap&lt;String, Object&gt;();
&nbsp; parameters.put("SERVICE", "WMS");
&nbsp; parameters.put("VERSION", "1.1.1");
&nbsp; parameters.put("REQUEST", "GetMap");
&nbsp; parameters.put("LAYERS", this.layers);
&nbsp; parameters.put("STYLES", this.styles);
&nbsp; parameters.put("CRS", this.crs);
&nbsp; parameters.put("BBOX", this.bbox);
&nbsp; parameters.put("WIDTH", this.width);
&nbsp; parameters.put("HEIGHT", this.height);
&nbsp; parameters.put("FORMAT", this.resultDataContentType);
&nbsp; parameters.put("EXCEPTIONS", "INIMAGE");
&nbsp; String url = UrlUtil.getUrl(this.wmsUrl, parameters);
&nbsp; try {
&nbsp;&nbsp;&nbsp; InputStream in = new URL(url).openStream();
&nbsp;&nbsp;&nbsp; try {
&nbsp;&nbsp;&nbsp;&nbsp;  FileUtil.copy(in, this.resultData);
&nbsp;&nbsp;  } finally {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; FileUtil.closeSilent(this.resultData);
&nbsp;&nbsp;&nbsp;&nbsp;  FileUtil.closeSilent(in);
&nbsp;&nbsp;&nbsp; }
&nbsp; } catch (MalformedURLException e) {
&nbsp;&nbsp;&nbsp; throw new IllegalArgumentException(url + " is not valid URL");
&nbsp; } catch (IOException e) {
&nbsp;&nbsp;  throw new RuntimeException("Unable to get map", e);
&nbsp; }
}
</pre> 
    </div> 
   </div> 
  </section> 
  <section> 
   <h4 id="logging1">Logging</h4> 
   <p>The CPF automatically creates <a href="admin/log.html">Log Files</a> for each module and business application running within the master and worker processes. For a business application the log level can be changed using the <a href="admin/app.html#edit">Edit Business Application</a> page without requiring a restart to the module.</p> 
   <blockquote> 
    <p><b>NOTE:</b> Applications MUST NOT include logging configuration files (e.g. log4j.xml) in their jars. They must also not manually create Appenders or otherwise change the logging configuration.</p> 
   </blockquote> 
   <p>The preferred approach is for business application plug-ins to use the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.log.AppLog">AppLog</a> class for logging to have the messages appear in the appropriate log file.</p> 
   <p>The plug-in The plug-in may also use <a class="externalLink" href="https://www.slf4j.org/">slf4j</a> (preferred) with the following logger name sub trees.</p> 
   <ul> 
    <li>Loggers below <code>{ModuleName}.{BusinessApplicationName}</code> (e.g. <code>DEMO.demoApp</code>).</li> 
    <li>Loggers below the <a href="cpf-api-plugin/java-api//#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.packageName">BusinessApplicationPlugin.packageName</a> (e.g. <code>ca.bc.gov.demo</code>)</li> 
   </ul> 
  </section> 
  <section> 
   <h4 id="memory_management1">Memory Management</h4> 
   <p>Plug-ins must ensure that their data and classes can be garbage collected when the plug-in is stopped. Below are some guidelines for ensuring garbage collection.</p> 
   <ul> 
    <li>Avoid using the Java singleton pattern for cached data structures. The data won’t be released until the class is garbage collected (which maybe neve depending on the JVM). Use a spring bean with the default singleton scope instead.</li> 
    <li>Avoid aspect oriented libraries, especially that use CGLIB. These sometimes create classes that can’t get garbage collected.</li> 
    <li>If using Java introspection/reflection, ensure that class and method references are not stored in a cache owned by another JVM. CPF has code to perform cache clearing for commons beanutils.</li> 
    <li>Implement a cleanup method on each bean (other than the plug-in prototype bean). This method must close any resources it created (e.g. database connections), clear any cached values and preferably set any fields to null. See the spring framework documentation for details on implementing <a class="externalLink" href="https://docs.spring.io/spring/docs/3.0.7.RELEASE/reference/beans.html#beans-factory-lifecycle-disposablebean">Destruction call-backs</a> or <a class="externalLink" href="https://docs.spring.io/spring/docs/3.0.7.RELEASE/reference/beans.html#beans-postconstruct-and-predestroy-annotations">@PreDestory</a> annotation. Spring will automatically call those methods when the plug-in is stopped.</li> 
   </ul> 
   <p>The CPF Tomcat JVM should be started with the following parameters to allow class unloading. Consult your JVM’s documentation for more details.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>-XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:+UseCodeCacheFlushing
</pre> 
    </div> 
   </div> 
   <p>In a non-production environment you can also turn on the following option to see the classes that were garbage collected on the console output from the Tomcat command.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>-XX:+TraceClassUnloading
</pre> 
    </div> 
   </div> 
   <p>The following procedure can be used to see if a CPF module can be un-loaded successfully.</p> 
   <ol style="list-style-type: decimal"> 
    <li>Restart the Tomcat JVM to ensure a clean start.</li> 
    <li>Make sure the CPF module is started (don’t restart if already started).</li> 
    <li>Stop the CPF module using the CPF admin application. Or to test CPF too undeploy the CPF web apps using the Tomcat manager.</li> 
    <li>Use the jconsole tool that comes with the JDK (not JRE) to connect to the Tomcat Java process.</li> 
    <li>Click on the memory tab.</li> 
    <li>Click on ‘Perform GC’ about 5 times to force a garbage collection.</li> 
    <li>Click on the Classes tab and see if the Loaded count is lower than the Total Loaded. This shows that some classes were garbage collected. You may need to do ‘Perform GC’ or wait a while as there is no contract as to when the class garbage collection will occur.</li> 
    <li>The following command creates a memory dump of the JVM you will need to know the process id [PID] of the Tomcat JVM. <code>jmap -dump:live,format=b,file=cpf.hprof {PID}</code>.</li> 
    <li>The cpf.hprof can be loaded into a Java Heap analyzer or the following command can be used to create a web server where you can browse the memory.</li> 
    <li><code>jhat -J-mx1024m cpf.hprof</code> (<b>NOTE</b>: you may need more memory depending on the amount of memory used in the Tomcat JVM).</li> 
    <li>Open <a class="externalLink" href="http://localhost:7000/">http://localhost:7000/</a> in a web browser. The <a class="externalLink" href="http://localhost:7000/showInstanceCounts/">Show Instance Counts</a> page is the most useful as it shows the counts of objects by class for non core Java class.</li> 
    <li>Check that the custom classes used by your application do no appear on this page. If they do then the application has not been garbage collected.</li> 
    <li>Click the instances link next to a class to see the instances. From there you can navigate to see the references to that object. This will help identify where cleanup code should be implemented.</li> 
   </ol> 
  </section> 
 </section> 
 <section> 
  <h3 id="customization1">Customization</h3> 
  <p>Plug-ins can customize certain aspects of the HTML forms for submitting jobs or how the files generated by the CPF for structured results. For example the sections to group fields on the forms or the URL to the style document to be used in KML documents.</p> 
  <section> 
   <h4 id="defining_customization_properties1">Defining Customization Properties</h4> 
   <p>The customization properties can be defined using an optional <code>properties</code> map bean in the <code>ca.bc.gov.open.cpf.plug-in.sf.xml</code> file.</p> 
   <p>The map can contain a <code>default</code> entry, or an entry for each business application name. The value for each entry is a map of the customization properties. If the property is not specified for a business application then the value from the default entry is used.</p> 
   <p><b>Example Plug-in Customization Properties</b></p> 
   <div class="source"> 
    <div class="source"> 
     <pre>&lt;util:map id="properties"&gt;
&nbsp;&nbsp;&lt;entry key="default"&gt;
&nbsp;  &lt;map&gt;
&nbsp;&nbsp;&nbsp;  &lt;entry
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  key="kmlPlaceMarkNameAttribute&lt;/b&gt;&gt;&lt;/em&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  value="fieldA&lt;/b&gt;&gt;&lt;/em&gt; /&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/map&gt;
&nbsp;&nbsp;&lt;/entry&gt;
&nbsp;&nbsp;&lt;entry key="demo"&gt;
&nbsp;  &lt;map&gt;
&nbsp;&nbsp;&nbsp;  &lt;entry
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  key="kmlPlaceMarkNameAttribute&lt;/b&gt;&gt;&lt;/em&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value="fieldB&lt;/b&gt;&gt;&lt;/em&gt; /&gt;
&nbsp;  &lt;/map&gt;
&nbsp;&nbsp;&lt;/entry&gt;
&lt;/util:map&gt;
</pre> 
    </div> 
   </div> 
   <p>Customization properties can also be set by adding a config property for a business application using the admin web application.</p> 
   <ol style="list-style-type: decimal"> 
    <li>Open the CPF modules admin page.</li> 
    <li>Click on the name of the module in the table, this will open the module view page.</li> 
    <li>Click the Business Applications tab to view the list of business applications.</li> 
    <li>Click on the name of the business application in the table, this will open the business application view page.</li> 
    <li>Click the Config Properties tab to view the current properties.</li> 
    <li>Click the id of a property to view it and then click Edit to change the value or click Add to add a new property.</li> 
   </ol> 
  </section> 
  <section> 
   <h4 id="form_customization_properties1">Form Customization Properties</h4> 
   <p>The following customization properties are used to define the sections to group fields on the forms and the default values for fields on the job submission forms.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Name</th> 
       <th>Type</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td><code>formSectionsOpen</code><br> <code>formSectionsOpenInstant</code><br> <code>formSectionsOpenSingle</code><br> <code>formSectionsOpenMultiple</code></td> 
       <td><code>List&lt;String&gt;</code></td> 
       <td> <p>The list of section names that are open on the job submission forms, all other sections will be closed by default. The open sections can be specified for all forms using <code>formSectionsOpen</code> or for a specific form using <code>formSectionsOpenInstant</code>, <code>formSectionsOpenSingle</code>, or <code>formSectionsOpenMultiple</code>. If not specified the open sections will be <code>applicationParameters</code>, <code>inputData</code>, and <code>resultFormat</code>.</p> <b>Example Form Open Sections Customization</b> 
        <div class="source"> 
         <div class="source"> 
          <pre class="xml">&lt;util:map id="properties"&gt;
  &lt;entry key="demo"&gt;
    &lt;map&gt;
      &lt;entry key="formSectionsOpen"&gt;
        &lt;set&gt;
          &lt;value&gt;applicationParameters&lt;/value&gt;
          &lt;value&gt;inputData&lt;/value&gt;
          &lt;value&gt;resultFormat&lt;/value&gt;
        &lt;/set&gt;
      &lt;/entry&gt;
      &lt;entry key="formSectionsOpenInstant"&gt;
        &lt;set&gt;
          &lt;value&gt;applicationParameters&lt;/value&gt;
          &lt;value&gt;requestParameters&lt;/value&gt;
          &lt;value&gt;resultFormat&lt;/value&gt;
        &lt;/set&gt;
      &lt;/entry&gt;
      &lt;entry key="formSectionsOpenSingle"&gt;
        &lt;set&gt;
          &lt;value&gt;applicationParameters&lt;/value&gt;
          &lt;value&gt;requestParameters&lt;/value&gt;
          &lt;value&gt;resultFormat&lt;/value&gt;
        &lt;/set&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/entry&gt;
&lt;/util:map&gt;</pre> 
         </div> 
        </div> </td> 
      </tr> 
      <tr class="a"> 
       <td><code>formSectionsMap</code><br> <code>formSectionsMapInstant</code><br> <code>formSectionsMapSingle</code><br> <code>formSectionsMapMultiple</code></td> 
       <td><code>List&lt;String&gt;</code></td> 
       <td> <p>This property is used to customize the sections and the fields in each section that appear on the job submission forms. The section field can be specified for all forms <code>formSectionsMap</code> or for a specific form <code>formSectionsMapInstant</code>, <code>formSectionsMapSingle</code>, <code>formSectionsMapMultiple</code>. The property is a <code>map</code> where the <code>key</code> on the <code>entry</code> is the name of the section and the value is a <code>list</code> of the field names. Section names should be in lowerCamelCase notation. The titles on the sections are converted to capitalized words from the section name (e.g. Lower Camel Case). Fields not applicable for a form will not be displayed. Any business application parameters not listed will be put into the <code>applicationParameters</code> section. Any CPF parameters not listed will be in the sections shown below.</p> <b>Default Form Fields by Section</b> 
        <div class="source"> 
         <div class="source"> 
          <pre class="xml">&lt;map&gt;
  &lt;entry key="inputData"&gt;
    &lt;list&gt;
      &lt;value&gt;inputDataContentType&lt;/value&gt;
      &lt;value&gt;inputDataUrl&lt;/value&gt;
      &lt;value&gt;inputData&lt;/value&gt;
      &lt;value&gt;srid&lt;/value&gt;
    &lt;/list&gt;
  &lt;/entry&gt;
  &lt;entry key="resultFormat"&gt;
    &lt;list&gt;
      &lt;value&gt;resultSrid&lt;/value&gt;
      &lt;value&gt;resultDataContentType&lt;/value&gt;
      &lt;value&gt;format&lt;/value&gt;
    &lt;/list&gt;
  &lt;/entry&gt;
  &lt;entry key="resultFormatAdvanced"&gt;
    &lt;list&gt;
      &lt;value&gt;resultNumAxis&lt;/value&gt;
      &lt;value&gt;resultScaleFactorXy&lt;/value&gt;
      &lt;value&gt;resultScaleFactorZ&lt;/value&gt;
    &lt;/list&gt;
  &lt;/entry&gt;
  &lt;entry key="notification"&gt;
    &lt;list&gt;
      &lt;value&gt;notificationEmail&lt;/value&gt;
      &lt;value&gt;notificationUrl&lt;/value&gt;
    &lt;/list&gt;
  &lt;/entry&gt;
  &lt;entry key="testParameters"&gt;
    &lt;list&gt;
      &lt;value&gt;cpfPlug-inTest&lt;/value&gt;
      &lt;value&gt;cpfMinExecutionTime&lt;/value&gt;
      &lt;value&gt;cpfMeanExecutionTime&lt;/value&gt;
      &lt;value&gt;cpfStandardDeviation&lt;/value&gt;
      &lt;value&gt;cpfMaxExecutionTime&lt;/value&gt;
      &lt;value&gt;cpfMeanNumResults&lt;/value&gt;
    &lt;/list&gt;
  &lt;/entry&gt;
&lt;/map&gt;</pre> 
         </div> 
        </div> <b>Plug-in Form Fields by Section Customization</b> 
        <div class="source"> 
         <div class="source"> 
          <pre class="xml">&lt;util:map id="properties"&gt;
  &lt;entry key="demo"&gt;
    &lt;map&gt;
      &lt;entry key="formSectionsMapInstant"&gt;
        &lt;map&gt;
          &lt;entry key="jobParmaters"&gt;
            &lt;list&gt;
              &lt;value&gt;jobParameter1&lt;/value&gt;
            &lt;/list&gt;
          &lt;/entry&gt;
        &lt;/map&gt;
      &lt;/entry&gt;
      &lt;entry key="formSectionsMapSingle"&gt;
        &lt;map&gt;
          &lt;entry key="jobParmaters"&gt;
            &lt;list&gt;
              &lt;value&gt;jobParameter1&lt;/value&gt;
            &lt;/list&gt;
          &lt;/entry&gt;
        &lt;/map&gt;
      &lt;/entry&gt;
    &lt;/map&gt;
  &lt;/entry&gt;
&lt;/util:map&gt;</pre> 
         </div> 
        </div> </td> 
      </tr> 
      <tr class="b"> 
       <td><code>inputDataContentType</code> or <code>inputDataFileExtension</code></td> 
       <td><code>String</code></td> 
       <td>The default value shown on forms for Input Data Content Type which is the MIME type or file extension of the input data specified by an inputData or inputDataUrl parameter.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>srid</code></td> 
       <td><code>int</code></td> 
       <td>The default value shown on forms for Srid which is the EPSG coordinate system code of the source geometry.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>resultDataContentType</code> or <code>resutDataFileExtension</code></td> 
       <td><code>String</code></td> 
       <td>The default value shown on forms for Result Data Content Type which is the MIME type or file extension of the result data specified by an resutData or resutDataUrl parameter.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>resultSrid</code></td> 
       <td><code>int</code></td> 
       <td>The default value shown on forms for Result Coordinate System which is the EPSG coordinate system code used for the result geometry.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>resultNumAxis</code></td> 
       <td><code>int</code></td> 
       <td>The default value shown on forms for Result Num Axis which is the number of coordinate axis in the result geometry (e.g. 2 for 2D or 3 for 3D).</td> 
      </tr> 
      <tr class="a"> 
       <td><code>resultScaleFactorXy</code></td> 
       <td><code>double</code></td> 
       <td>The default value shown on forms for Result Scale Factor Xy which is the scale factor to apply the x, y coordinates. The scale factor is 1 / minimum unit. For example if the minimum unit was 1mm (0.001) the scale factor is 1000 (1 / 0.001).</td> 
      </tr> 
      <tr class="b"> 
       <td><code>resultScaleFactorZ</code></td> 
       <td><code>double</code></td> 
       <td>The default value shown on forms for Result Scale Factor Z which is the scale factor to apply the z coordinates. The scale factor is 1 / minimum unit. For example if the minimum unit was 1mm (0.001) the scale factor is 1000 (1 / 0.001).</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
  </section> 
  <section> 
   <h4 id="result_file_customization_properties1">Result File Customization Properties</h4> 
   <p>The following customization properties are supported.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Name</th> 
       <th>Type</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td><code>kmlDocumentName</code></td> 
       <td><code>String</code></td> 
       <td>The text to use as the name of the KML Document. <b>NOTE: Don't use on a per result basis.</b></td> 
      </tr> 
      <tr class="a"> 
       <td><code>kmlDocumentDescription</code></td> 
       <td><code>String</code></td> 
       <td>The text to use as the description of the KML Document. <b>NOTE: Don't use on a per result basis.</b></td> 
      </tr> 
      <tr class="b"> 
       <td><code>kmlStyle</code></td> 
       <td><code>String</code></td> 
       <td>A list of one or more KML Style tags containing a custom style for the whole document. <b>NOTE: Don't use on a per result basis.</b> External styles should be preferred.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>kmlPlacemarkDescription</code></td> 
       <td><code>String</code></td> 
       <td>The text to use as the description of the KML Placemark created for each result.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>kmlPlaceMarkNameAttribute</code></td> 
       <td><code>String</code></td> 
       <td>The name result attribute to use as the Name of the KML Placemark created for each result.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>kmlSnippet</code></td> 
       <td><code>String</code></td> 
       <td>The text to use as the snippet of the KML Placemark created for each result.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>kmlStyleUrl</code></td> 
       <td><code>String</code></td> 
       <td>The text to use as the styleUrl of the KML Placemark created for each result.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>kmlWriteNulls</code></td> 
       <td><code>boolean</code></td> 
       <td>Flag indicating if attributes will null values are to be included in the KML document. By default attributes with null values are NOT included in the extended data. If true then the attribute will be included as a &lt;value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" /&gt; tag.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>kmlLookAtRange</code></td> 
       <td><code>double</code></td> 
       <td>The range to include in the look at element. If omitted then it will be calculated from the geometry. The calculation for points always returns 1000.</td> 
      </tr> 
      <tr class="a"> 
       <td><code>kmlLookAtMinRange</code></td> 
       <td><code>double</code></td> 
       <td>The minimum value for the range to include in the look at element. This value is used if the kmlLookAtRange or calculated range is less than this value.</td> 
      </tr> 
      <tr class="b"> 
       <td><code>kmlLookAtMaxRange</code></td> 
       <td><code>double</code></td> 
       <td>The maximum value for the range to include in the look at element. This value is used if the kmlLookAtRange or calculated range is greater than this value.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
   <p>See the <a class="externalLink" href="https://developers.google.com/kml/documentation/kmlreference">kml reference guide</a> for details on how to use the KML attributes.</p> 
   <p>Result file customization properties can also be specified on a plug-in class or on the result object for plug-ins that return a list of results. This allows the property to be calculated for each result. For example the <code>kmlStyleUrl</code> may vary based on the type of result. The following example show the optional method that must be implemented for plug-ins that wish to define per result configuration properties.</p> 
   <p><b>Example Plug-in Result Customization Properties</b></p> 
   <div class="source"> 
    <div class="source"> 
     <pre>public Map&lt;String, Object&gt; getCustomizationProperties() {
&nbsp;&nbsp;Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
&nbsp;&nbsp;properties.put("propertyName", "propertyValue");
  String styleId = "demo"; /** Calculated from some field on object */
&nbsp;&nbsp;properties.put("kmlStyleUrl", "http://gov.bc.ca/kmlStyle.kml#" + styleId);
&nbsp;&nbsp;return properties;
}
</pre> 
    </div> 
   </div> 
  </section> 
 </section> 
 <section> 
  <h3 id="configuration1">Configuration</h3> 
  <p>Plug-ins can include a default configuration file that contains any configuration that will change from environment to environment. Such as database connection URLs and passwords. The configuration file provided in the application is a template that is used to populate the CPF configuration database with initial values for the administrator to edit with the values for that environment.</p> 
  <blockquote> 
   <p>NOTE:** Plug-ins must fully document all supported configuration properties in their readme file and other documentation where appropriate.</p> 
   <p><b>NOTE:</b> Plug-ins must not require a configuration file to be created on the file system and they must not require manual editing of source code for specific environments. The same code must be compiled only once for use in all environments.</p> 
  </blockquote> 
  <p>If a plug-in requires configuration properties the following JSON file must be created in the maven module for the project.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>src/main/resources/META-INF/ca.bc.gov.open.cpf.plugin.ConfigProperties.json
</pre> 
   </div> 
  </div> 
  <div class="source"> 
   <div class="source"> 
    <pre>[
  {
    "name": "name1",
    "type": "string",
    "value": "value1"
  },
  {
    "name": "name2",
    "type": "int",
    "value": "value2"
  },
]
</pre> 
   </div> 
  </div> 
  <p>The configuration file is a JSON list containing JSON objects for each property. Each configuration JSON object represents one configuration property and must include the following attributes.</p> 
  <div class="table-responsive"> 
   <table border="0" class="table table-condensed table-striped tabled-bordered"> 
    <thead> 
     <tr class="a"> 
      <th>Attribute</th> 
      <th>Description</th> 
     </tr> 
    </thead> 
    <tbody> 
     <tr class="b"> 
      <td><code>name</code></td> 
      <td>The name of the property (or sub property). The name can either be place-holders in the spring configuration file or can override bean properties from the spring configuration file. The recommendation is to reduce the number of place-holders and use overrides instead. Include default values in the spring bean files.</td> 
     </tr> 
     <tr class="a"> 
      <td><code>type</code></td> 
      <td>The Java [data type](reference/dataTypes.html) of the value. Must be the same type as the Java set property method.</td> 
     </tr> 
     <tr class="b"> 
      <td><code>value</code></td> 
      <td>The string value of the property, it must be possible to convert this value to the Java data type specified in the type attribute.</td> 
     </tr> 
    </tbody> 
   </table> 
  </div> 
  <p>Consider the example of a data source defined with the following bean definition.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;bean
  id="demoDataSource"
  class=" com.revolsys.jdbc.io.JdbcDataSourceFactoryBean"
  p:url="jdbc:postgresql://localhost:5432/postgres"
  p:username="demo"
  p:password="12345678"
&gt;
  &lt;property
    name="config"
  &gt;
    &lt;map&gt;
      &lt;entry
        key="initialConnections"
        value="0" /&gt;
      &lt;entry
        key="maxConnections"
        value="10" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;
</pre> 
   </div> 
  </div> 
  <p>To override the URL and the password the following properties would be created.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>[
  {
    "name": "demoDataSource.url",
    "type": "string",
    "value": " jdbc:postgresql://localhost:5432/demo"
  },
  {
    "name": "demo.timeout",
    "type": "int",
    "value": "10"
  },
]
</pre> 
   </div> 
  </div> 
  <p>Once a module has been deployed the configuration properties can be modified using the CPF admin application.</p> 
  <ol style="list-style-type: decimal"> 
   <li>Open the CPF modules admin page.</li> 
   <li>Click on the name of the module in the table, this will open the module view page.</li> 
   <li>Click the Module Config Properties tab to view the current properties.</li> 
   <li>Click the id of a property to view it and then click Edit to change the value.</li> 
   <li>Click the id of a property to view it and then click Edit to change the value or click Add to add a new property.</li> 
  </ol> 
 </section> 
 <section> 
  <h3 id="security1">Security</h3> 
  <p>The CPF provides a Security service that allows a plug-in to query information about the user, check group memberships and check permission to access resources.</p> 
  <section> 
   <h4 id="security_groups1">Security Groups</h4> 
   <p>The CPF uses groups of users to manage the security policies for plug-ins. All policies are associated with security groups as opposed to individual users.</p> 
   <p>See the CPF Admin Guide for more detail on managing groups using the CPF admin application.</p> 
   <p>There are three types of user group.</p> 
   <section> 
    <h5 id="user_type1">User type</h5> 
    <p>The <code>USER_TYPE</code> user groups are virtual groups that indicate the type of user. In the BC Government infrastructure the following <code>USER_TYPE</code> groups are supported.</p> 
    <div class="simpleDataTable"> 
     <div class="table-responsive"> 
      <table border="0" class="table table-condensed table-striped tabled-bordered"> 
       <thead> 
        <tr class="a"> 
         <th>Name</th> 
         <th>Description</th> 
        </tr> 
       </thead> 
       <tbody> 
        <tr class="b"> 
         <th>BCGOV_ALL</th> 
         <td>BC Government All Users</td> 
        </tr> 
        <tr class="a"> 
         <th>BCGOV_BUSINESS</th> 
         <td>BC Government External Business Users</td> 
        </tr> 
        <tr class="b"> 
         <th>BCGOV_EXTERNAL</th> 
         <td>BC Government External Users</td> 
        </tr> 
        <tr class="a"> 
         <th>BCGOV_INDIVIDUAL</th> 
         <td>BC Government External Individual Users</td> 
        </tr> 
        <tr class="b"> 
         <th>BCGOV_INTERNAL</th> 
         <td>BC Government Internal Users</td> 
        </tr> 
        <tr class="a"> 
         <th>BCGOV_VERIFIED_INDIVIDUAL</th> 
         <td>BC Government External Verified Individual</td> 
        </tr> 
       </tbody> 
      </table> 
     </div> 
    </div> 
   </section> 
   <section> 
    <h5 id="global1">Global</h5> 
    <p>The <code>GLOBAL</code> user groups are created and managed by the CPF security administrator using the CPF user groups admin page. These are shared across all the plug-ins in the system. There are no <code>GLOBAL</code> groups installed by default.</p> 
   </section> 
   <section> 
    <h5 id="plug-in_groups1">Plug-in Groups</h5> 
    <p>Each plug-in can also have their own user groups that are specific to that plug-in and not shared between plug-ins. Module specific groups must have the {Module Name}_ as a prefix (e.g. the partner group for the DEMO module would be DEMO_PARTNER).</p> 
    <ol style="list-style-type: decimal"> 
     <li>Open the CPF modules admin page.</li> 
     <li>Click on the name of the module in the table, this will open the module view page.</li> 
     <li>Click the User Groups tab to view the groups available for the module, it will include USER_TYPE, GLOBAL and module specific groups.</li> 
     <li>Click the name of a group to view it and then click Edit to change the group name or description. Editing is only possible for module specific groups.</li> 
     <li>Or click Add to add a new module user group.</li> 
     <li>On the View user group page click the User Accounts for Group tab to add or remove users from the group. Adding or removing users to a group is only possible for module specific groups.</li> 
    </ol> 
   </section> 
  </section> 
  <section> 
   <h4 id="security_permissions1">Security Permissions</h4> 
   <p>The CPF allows security permissions to be granted to groups of users. Security permissions grant members of a group permission to perform a specified action on a resource. Negative permissions that deny access to a resource are not supported.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Attribute</th> 
       <th>Example</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td>resourceClass</td> 
       <td>reportName</td> 
       <td>The resourceClass is used to categorize the type of resource that the policy applies to. This could be the same name as the plug-in parameter that contains the resource identifier to check.</td> 
      </tr> 
      <tr class="a"> 
       <td>resourceId</td> 
       <td>Demo Report</td> 
       <td>The resourceId is the identifier of the resource.</td> 
      </tr> 
      <tr class="b"> 
       <td>action</td> 
       <td>View</td> 
       <td>The name of the action that can be performed on the resource. Use common names such as View, Edit for the action name.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
   <p>The special value ‘All’ can be used as a wildcard for the resourceClass, resourceId or action. When enforcing permissions the ‘All’ value will match any requested value for that attribute when the plug-in uses the security service to check if a user can access a resource.</p> 
   <p>Security permissions can be granted using the CPF admin application.</p> 
   <ol style="list-style-type: decimal"> 
    <li>Open the CPF modules admin page.</li> 
    <li>Click on the name of the module in the table, this will open the module view page.</li> 
    <li>Click the User Groups tab to view the groups available for the module, it will include USER_TYPE, GLOBAL and module specific groups.</li> 
    <li>Click the name of a group to view it and then click Edit to change the group name or description. Editing is only possible for module specific groups.</li> 
    <li>On the View user group page click the User Group Permissions tab to add, view and edit permissions.</li> 
   </ol> 
  </section> 
  <section> 
   <h4 id="security_configuration_file1">Security Configuration File</h4> 
   <p>In addition to manually defining security groups and permissions using the CPF Admin Application a plug-in can include a configuration file in the plug-in jar. The following must be created as a JSON document.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>src/main/resources/META-INF/ca.bc.gov.open.cpf.plugin.UserGroups.json
</pre> 
    </div> 
   </div> 
   <p>The User Groups config file is a JSON list of JSON objects. Each object represents a user group to be created or to create permissions for. Only groups starting with the {Module Name}_ prefix will be created. The USER_TYPE or GLOBAL groups must already exist for permissions to be added to them.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Attribute</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td>name</td> 
       <td>The name of the group to create or grant permissions to (e.g. DEMO_PARTNER).</td> 
      </tr> 
      <tr class="a"> 
       <td>permissions</td> 
       <td>A JSON list of JSON objects containing the permissions to grant. See table below for list of permission attributes.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
   <p>The following table shows the JSON attributes for a permission object.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Attribute</th> 
       <th>Example</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td>resourceClass</td> 
       <td>reportName</td> 
       <td>The resourceClass is used to categorize the type of resource that the policy applies to. This could be the same name as the plug-in parameter that contains the resource identifier to check.</td> 
      </tr> 
      <tr class="a"> 
       <td>resourceId</td> 
       <td>Demo Report</td> 
       <td>The resourceId is the identifier of the resource.</td> 
      </tr> 
      <tr class="b"> 
       <td>action</td> 
       <td>View</td> 
       <td>The name of the action that can be performed on the resource. Use common names such as View, Edit for the action name.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
   <p>The following example shows a group called DEMO_PARTNER that will be created if it does not exist. The members of that group will be granted the permission to View the Demo Report. Members of the BCGOV_INTERNAL group will be granted permission to View All reports.</p> 
   <div class="source"> 
    <div class="source"> 
     <pre>[
&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;"name": "DEMO_PARTNER",
&nbsp;&nbsp;&nbsp;&nbsp;"permissions": [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "resourceClass"&nbsp; : "reportName",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "resourceId"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: "Demo Report",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "action"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : "View"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp;&nbsp;]
&nbsp; },
&nbsp; {
&nbsp;&nbsp;&nbsp; "name": BCGOV_INTERNAL,
&nbsp;&nbsp;&nbsp; "permissions": [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "resourceClass&nbsp; : "reportName",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "resourceId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: "All",
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : "View"
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
&nbsp;&nbsp;&nbsp; ]
&nbsp; }
]
</pre> 
    </div> 
   </div> 
  </section> 
  <section> 
   <h4 id="business_application_permissions1">Business Application Permissions</h4> 
   <p>Plug-ins can control the the users that can use a business application using the <a href="cpf-api-plugin/java-api/#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.batchModePermission">batchModePermission</a> or <a href="cpf-api-plugin/java-api/#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin.instantModePermission">instantModePermission</a> annotation parameters on the plug-in class.</p> 
   <p>The permissions can be overridden on the Business Application Edit page in the CPF admin web application.</p> 
   <ol style="list-style-type: decimal"> 
    <li>Open the CPF modules admin page.</li> 
    <li>Click on the name of the module in the table, this will open the module view page.</li> 
    <li>Click the Business Applications tab.</li> 
    <li>Click the name of a business application to view it and then click Edit.</li> 
    <li>Edit the Batch Mode Permission or Instant Mode Permission with a valid <a class="externalLink" href="https://static.springsource.org/spring-security/site/docs/3.0.x/reference/el-access.html">Spring security expression</a>.</li> 
   </ol> 
  </section> 
  <section> 
   <h4 id="request_level_security1">Request Level Security</h4> 
   <p>Plugi-ins can control access to individual requests in the <a href="cpf-api-plugin/java-api/#ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPlugin">BusinessApplicationPlugin</a> class. See the [SecurityService](cpf-api-plugin/java-api/#ca.bc.gov.open.cpf.plugin.api.security.SecurityService for more details.</p> 
  </section> 
 </section> 
 <section> 
  <h3 id="testing1">Testing</h3> 
  <p>The business application plug-in can be tested by creating a test harness, using the CPF web site or using a CPF client to connect to the CPF web services.</p> 
  <section> 
   <h4 id="cpf_web_site1">CPF Web Site</h4> 
   <p>If the CPF is deployed to /cpf on localhost the list of business applications can be found using the following page.</p> 
   <p>(<a class="externalLink" href="http://localhost/cpf/ws/apps/">http://localhost/cpf/ws/apps/</a>)</p> 
   <p>Click on the link for a business application to get the list of resources for that application. Depending on the plug-in the following resources maybe available.</p> 
   <div class="table-responsive"> 
    <table border="0" class="table table-condensed table-striped tabled-bordered"> 
     <thead> 
      <tr class="a"> 
       <th>Resource</th> 
       <th>Description</th> 
      </tr> 
     </thead> 
     <tbody> 
      <tr class="b"> 
       <td>specification</td> 
       <td>The HTML page describing the parameters and result attributes of the business application.</td> 
      </tr> 
      <tr class="a"> 
       <td>instant</td> 
       <td>If the plug-in allows instant mode there will be a form that allows a user to submit a single request and get the results back immediately.</td> 
      </tr> 
      <tr class="b"> 
       <td>single</td> 
       <td>The single request form allows the parameters for a single request to be entered using form fields insteadof requiring a file of structured input data. Unlike the instant mode the request is processed via a job.</td> 
      </tr> 
      <tr class="a"> 
       <td>multiple</td> 
       <td>The multiple request form contains fields for the job parameters and accepts a file upload or a URL forthe request data fields.</td> 
      </tr> 
     </tbody> 
    </table> 
   </div> 
   <p>Use one of the above forms to create a new job and then download the results to confirm that the plug-in works as expected.</p> 
  </section> 
  <section> 
   <h4 id="test_harness1">Test Harness</h4> 
   <p>The BusinessApplicationPluginExecutor class allows developers to execute a single request against their plug-in without deploying it to the CPF infrastructure. The executor converts the input parameters to a JSON object and back again to simulate what happens in the internal CPF processing.</p> 
   <p>To create a test harness construct an instance of ca.bc.gov.open.cpf.plugin.api.BusinessApplicationPluginExecutor and then use one of the following methods to invoke the plug-in.</p> 
  </section> 
 </section> 
</section>                    </main>
        <div class="d-none d-sm-none d-md-none d-lg-none d-xl-block col-xl-2">
            </div>
    </div> <!-- row: end -->
</div> <!-- .main-body: end -->
    <div id="m-scroll-top" style="display: none;">
        <a href="javascript:;">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
  <!-- Footer -->
<footer class="footer-light bg-light">
    <div class="container">
        <div class="row">
                        <div class="col bottom-nav">
                <ul class="nav flex-column nav-list">
                </ul>
            </div>
        </div> <!-- END: .row -->
    </div> <!-- END: .container -->
</footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="copyright">Copyright &copy;2008-2021
                 <a href="https://www.gov.bc.ca/">Province of British Columbia</a>
. All Rights Reserved.</p>
        <p class="version-date">
<span class="projectVersion">Version: 6.1.x-SNAPSHOT. </span><span class="publishDate">
    Last Published: 2021-Mar-15
. </span>        </p>
      </div>
    </div>
  </div>

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/${popperVersion}/umd//popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <script src="./js/lightbox.min.js" crossorigin="anonymous"></script>
            		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js" crossorigin="anonymous"></script>
              <script src="./js/reflow-skin.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js" crossorigin="anonymous"></script>
    </body>
</html>
