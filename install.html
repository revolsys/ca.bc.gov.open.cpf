





 

 
 
 

 

 
 
     <!doctype html>
<!--
 Generated by Apache Maven Doxia  at 2021-Mar-15  Rendered using Reflow Maven Skin 2.0.2 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
                                                                  
                    <head>
    <meta charset="UTF-8" />
    <title>Concurrent Processing Framework &#x2013; CPF Installation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
      <meta http-equiv="content-language" content="en" />
                                                        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v${fontawesomeVersion}/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link href="./css/docs.css" rel="stylesheet" />
    <link href="./css/reflow-skin.css" rel="stylesheet" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css" />

    <link href="./css/lightbox.css" rel="stylesheet" />
    <link href="./css/site.css" rel="stylesheet" />
    <link href="./css/print.css" rel="stylesheet" media="print" />

        </head> <!-- end : head -->
<body class="page-install project-cpf-parent anchorjs-enabled scrolltop-smooth-enabled m-toc-top-enabled">
    <nav id="m-top-navbar" class="navbar navbar-expand-lg fixed-top navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand mb-0 h1" href=".">
                <span class="color-highlight">CPF</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-collapse-1" aria-controls="top-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item dropdown active">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="index.html" title="About"  class="dropdown-item ">About</a>
                             <a href="" title="Installation"  class="dropdown-item active">Installation</a>
                             <a href="plugin.html" title="Plug-in Developer Guide"  class="dropdown-item ">Plug-in Developer Guide</a>
                             <a href="client.html" title="Client Developer Guide"  class="dropdown-item ">Client Developer Guide</a>
                             <a href="admin.html" title="Administrator Guide"  class="dropdown-item ">Administrator Guide</a>
                             <div class="dropdown-submenu">
<a     
     title="Reference"  class="dropdown-item" >Reference</a>                                <div class="dropdown-menu">
                                    <a href="reference/maven.html" title="Maven"  class="dropdown-item ">Maven</a>
                                    <a href="reference/authentication.html" title="Authentication"  class="dropdown-item ">Authentication</a>
                                    <a href="reference/dataTypes.html" title="Data Types"  class="dropdown-item ">Data Types</a>
                                    <a href="reference/fileFormats.html" title="File Formats"  class="dropdown-item ">File Formats</a>
                                    <a href="reference/resourceDescription.html" title="Resource Description"  class="dropdown-item ">Resource Description</a>
                                    <a href="reference/jobStatus.html" title="Job Status"  class="dropdown-item ">Job Status</a>
                                    <a href="reference/structuredData.html" title="Structured Data"  class="dropdown-item ">Structured Data</a>
                                    <a href="reference/opaqueData.html" title="Opaque Data"  class="dropdown-item ">Opaque Data</a>
                                </div>
                            </div>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Modules <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="cpf-api-plugin/index.html" title="Concurrent Processing Framework Business Application Plugin API"  class="dropdown-item ">Concurrent Processing Framework Business Application Plugin API</a>
                             <a href="cpf-api-client/index.html" title="Concurrent Processing Framework Client Java API"  class="dropdown-item ">Concurrent Processing Framework Client Java API</a>
                             <a href="cpf-api-app/index.html" title="Concurrent Processing Framework Application Java API"  class="dropdown-item ">Concurrent Processing Framework Application Java API</a>
                             <a href="cpf-api-worker/index.html" title="Concurrent Processing Framework API Worker"  class="dropdown-item ">Concurrent Processing Framework API Worker</a>
                             <a href="cpf-war-app/index.html" title="Concurrent Processing Framework Base WAR Web Application"  class="dropdown-item ">Concurrent Processing Framework Base WAR Web Application</a>
                             <a href="cpf-war-worker/index.html" title="Concurrent Processing Framework Base WAR Worker"  class="dropdown-item ">Concurrent Processing Framework Base WAR Worker</a>
                             <a href="cpf-archetype-plugin/index.html" title="CPF Plug-in Maven Arechtype"  class="dropdown-item ">CPF Plug-in Maven Arechtype</a>
                             <a href="cpf-archetype-web/index.html" title="Concurrent Processing Framework Archetype Web"  class="dropdown-item ">Concurrent Processing Framework Archetype Web</a>
                             <a href="plugins/test/index.html" title="CPF Test Plugins"  class="dropdown-item ">CPF Test Plugins</a>
                             <a href="plugins/digest/index.html" title="Digest Plug-in"  class="dropdown-item ">Digest Plug-in</a>
                             <a href="plugins/geometry-validation/index.html" title="Geometry Validation Plug-in"  class="dropdown-item ">Geometry Validation Plug-in</a>
                             <a href="plugins/mandelbrot/index.html" title="Mandelbrot Plug-in"  class="dropdown-item ">Mandelbrot Plug-in</a>
                             <a href="plugins/map-tile/index.html" title="Map Tile Plug-in"  class="dropdown-item ">Map Tile Plug-in</a>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Contribute <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="https://github.com/revolsys/cpf/" title="GitHub Project"  class="dropdown-item ">GitHub Project</a>
                             <a href="https://github.com/revolsys/cpf/issues/" title="Issues (GitHub)"  class="dropdown-item ">Issues (GitHub)</a>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Links <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <a href="https://www2.gov.bc.ca" title="Province of British Columbia" target="_blank" class="dropdown-item ">Province of British Columbia</a>
                             <a href="https://bcdevexchange.org/" title="BC Developer Exchange" target="_blank" class="dropdown-item ">BC Developer Exchange</a>
                          </div>
                    </li>
                      <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Maven documentation <b class="caret"></b></a>
                        <div class="dropdown-menu">
                            <div class="dropdown-submenu">
<a     
     href="project-info.html"  title="Project Information"  class="dropdown-item" >Project Information</a>                                <div class="dropdown-menu">
                                    <a href="dependency-convergence.html" title="Dependency Convergence"  class="dropdown-item ">Dependency Convergence</a>
                                    <a href="dependency-info.html" title="Dependency Information"  class="dropdown-item ">Dependency Information</a>
                                    <a href="dependency-management.html" title="Dependency Management"  class="dropdown-item ">Dependency Management</a>
                                    <a href="distribution-management.html" title="Distribution Management"  class="dropdown-item ">Distribution Management</a>
                                    <a href="index.html" title="About"  class="dropdown-item ">About</a>
                                    <a href="issue-management.html" title="Issue Management"  class="dropdown-item ">Issue Management</a>
                                    <a href="licenses.html" title="Licenses"  class="dropdown-item ">Licenses</a>
                                    <a href="modules.html" title="Project Modules"  class="dropdown-item ">Project Modules</a>
                                    <a href="plugin-management.html" title="Plugin Management"  class="dropdown-item ">Plugin Management</a>
                                    <a href="plugins.html" title="Plugins"  class="dropdown-item ">Plugins</a>
                                    <a href="scm.html" title="Source Code Management"  class="dropdown-item ">Source Code Management</a>
                                    <a href="summary.html" title="Summary"  class="dropdown-item ">Summary</a>
                                    <a href="team.html" title="Team"  class="dropdown-item ">Team</a>
                                </div>
                            </div>
                             <div class="dropdown-submenu">
<a     
     href="project-reports.html"  title="Project Reports"  class="dropdown-item" >Project Reports</a>                                <div class="dropdown-menu">
                                    <a href="apidocs/index.html" title="Javadoc"  class="dropdown-item ">Javadoc</a>
                                </div>
                            </div>
                          </div>
                    </li>
                   </ul><!--/ul.navbar-nav -->
            </div><!--/.nav-collapse -->
        </div> <!--/.container -->
    </nav> <!--/.navbar -->
    <div class="main-body container-fuild my-3">
    <div class="row m-0">
        <div class="d-xs-none d-sm-none d-md-none d-lg-block col-lg-2">
        </div>
        <main class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-8" role="main">
            <div class="header container-fluid">
                      <div class="jumbotron subhead">
        <div class="row m-1" id="banner">
          <div class="col-md-12">
            <div class="float-left bannerLeft">
                                  <div class="bannerLeft">
            <h1>Concurrent Processing Framework</h1>
            </div>
            </div>
            <div class="float-right bannerRight">
                                  <a href="https://www2.gov.bc.ca">
            <img class="float-left m-2 img-fluid" src="images/bc_sun_logo_horiz.gif"  />
            <h1>Province of British Columbia</h1>
            </a>
            </div>
          </div>
        </div>
      </div>
                     <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a     
     href="."  title="CPF"  class="" >CPF</a></li>
            <li class="breadcrumb-item active">CPF Installation</li>
        </ol>
    </nav>
            </div> <!-- end : header -->
                    <hr class="toc-separator" />
    <div id="m-toc-topbar" class="navbar navbar-expand-lg navbar-light bg-light">
      <div id="toc-scroll-target">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#m-toc-topnav-collapse" aria-controls="m-toc-topnav-collapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        <div id="m-toc-topnav-collapse" class="collapse navbar-collapse">
            <ul id="m-toc-topnav" class="navbar-nav">
                                                <li class="nav-item toplevel"><a class="nav-link" href="#cpf_installation1" title="CPF Installation">CPF Installation</a></li>
                        <li class="nav-item divider-vertical"></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Database Installation" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Database Installation</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#database_installation1" title="Database Installation">Database Installation</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#requirements1" title="Requirements">Requirements</a>
                <a class="dropdown-item" href="#download_sql_scripts1" title="Download SQL Scripts">Download SQL Scripts</a>
                <a class="dropdown-item" href="#cpf_database_install_configuration1" title="CPF Database Install Configuration">CPF Database Install Configuration</a>
                <a class="dropdown-item" href="#cpf_database_and_schema_install1" title="CPF Database and schema install">CPF Database and schema install</a>
                            </div>
                        </li>
                        <li class="nav-item divider-vertical"></li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" title="Web Application Installation" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Web Application Installation</a>
                            <div class="dropdown-menu">
                                <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
                                <a class="dropdown-item" href="#web_application_installation1" title="Web Application Installation">Web Application Installation</a>
                                <div class="dropdown-divider"></div>
                                              <a class="dropdown-item" href="#create_cpf_directories1" title="Create CPF directories">Create CPF directories</a>
                <a class="dropdown-item" href="#update_maven_settingsxml_to_use_the_cpf_maven_repo" title="Update maven settings.xml to use the CPF maven repository">Update maven settings.xml to use the CPF maven repository</a>
                <a class="dropdown-item" href="#create_a_cpf_web_application_project1" title="Create a CPF web application project">Create a CPF web application project</a>
                <a class="dropdown-item" href="#maven_settings_configuration1" title="Maven Settings Configuration">Maven Settings Configuration</a>
                <a class="dropdown-item" href="#cpf_runtime_configuration1" title="CPF Runtime Configuration">CPF Runtime Configuration</a>
                <a class="dropdown-item" href="#external_maven_repository_configuration1" title="External Maven Repository Configuration">External Maven Repository Configuration</a>
                <a class="dropdown-item" href="#deploy_to_tomcat_901" title="Deploy to Tomcat 9.0">Deploy to Tomcat 9.0</a>
                            </div>
                        </li>
            </ul>
        </div>
      </div> <!-- .container -->
    </div> <!-- end: m-toc-topbar -->
                 <section> 
 <div class="page-header">
  <h2 id="cpf_installation1">CPF Installation</h2>
 </div> 
 <p>Plug-in developers will want to install a copy of CPF on their local environment to develop and test their CPF plug-ins. The following sections included detailed steps on installing the CPF database and web application.</p> 
</section> 
<section> 
 <h2 id="database_installation1">Database Installation</h2> 
 <p>The CPF requires a PostgreSQL or Oracle database to be installed for use by the CPF application.</p> 
 <p>A local copy of the CPF databases should be deployed at a developer’s site. For projects with multiple developers it is recommended to install a local database on each developer’s workstation and one on a central integration test server.</p> 
 <blockquote> 
  <p><b>NOTE:</b> Installation of database for any business application plug-ins is outside the scope of the CPF.</p> 
 </blockquote> 
 <section> 
  <h3 id="requirements1">Requirements</h3> 
  <p>The CPF requires a database to store the CPF configuration, Job requests and Job results. The following databases are currently supported.</p> 
  <ul> 
   <li>PostgreSQL 11.5+</li> 
   <li>Oracle 12c+</li> 
  </ul> 
  <p><b>NOTE:</b> Older versions may work but haven’t been recently tested.</p> 
  <p>A developer may also require additional databases for use by their plug-in. They must deliver all required SQL scripts and instructions on how to install these databases.</p> 
  <blockquote> 
   <p><b>NOTE:</b> For PostgreSQL the server instance can be shared with other applications but it is recommended to have a separate “database” within that instance for CPF. For Oracle there is no such restriction.</p> 
  </blockquote> 
 </section> 
 <section> 
  <h3 id="download_sql_scripts1">Download SQL Scripts</h3> 
  <p>The SQL scripts to install the database can be downloaded from the <a class="externalLink" href="https://github.com/bcgov/cpf">https://github.com/bcgov/cpf</a> repository.</p> 
  <p>Use the following scripts will download the CPF Oracle and PostgreSQL scripts.</p> 
  <p>** UNIX/Mac**</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>svn co https://github.com/bcgov/cpf/trunk/sql
cd sql
</pre> 
   </div> 
  </div> 
  <p><b>Windows</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>svn co https://github.com/bcgov/cpf/trunk/sql
cd sql
</pre> 
   </div> 
  </div> 
  <blockquote> 
   <p><b>NOTE:</b> If you have previously downloaded the SQL use the following command from the sql directory to ensure that you have the latest version.</p> 
  </blockquote> 
  <div class="source"> 
   <div class="source"> 
    <pre>svn up
</pre> 
   </div> 
  </div> 
 </section> 
 <section> 
  <h3 id="cpf_database_install_configuration1">CPF Database Install Configuration</h3> 
  <p>The database install scripts use the db.properties configuration file for database connection and configuration parameters. Copy the db-sample.properties file from the postgresql or oracle directory to use as a template.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>cd postgresql # or cd oracle
cp db-sample.properties db.properties
chmod 600 db.properties
</pre> 
   </div> 
  </div> 
  <blockquote> 
   <p><b>NOTE:</b> Change permissions on the <code>db.properties</code> so that only you have read/write permissions on the file to keep the passwords secret.</p> 
  </blockquote> 
  <p>Edit the <code>db.properties</code> file.</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Property </th> 
     <th>Example Value</th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td><code>DB_HOSTNAME</code> </td> 
     <td><code>localhost</code> </td> 
     <td>The hostname of the PostgreSQL sever. Not used for Oracle.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>DB_PORT</code> </td> 
     <td><code>5432</code> </td> 
     <td>The port of the PostgreSQL sever. Not used for Oracle.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>DB_NAME</code> </td> 
     <td><code>cpf</code> </td> 
     <td>The PostgreSQL database name or Oracle TNSNAME, tnsnames.ora must be configured.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>CPF_PASSWORD</code> </td> 
     <td><code>cpf_0wn3r</code> </td> 
     <td>The password to create the CPF database account with.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>PROXY_CPF_WEB_PASSWORD</code></td> 
     <td><code>c0ncurr3n7</code> </td> 
     <td>The password to create the PROXY_CPF_WEB database account with.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>TABLESPACE_DIR</code> </td> 
     <td><code>/data/postgres/cpf</code></td> 
     <td>The directory to create the database tablespace in. The directory must exist on the server and the PostgreSQL or Oracle process must have write permissions on this directory.</td> 
    </tr> 
   </tbody> 
  </table> 
  <p>For PostgreSQL, to avoid needing to enter in the passwords for each SQL command create a <code>~/.pgpass</code> on UNIX or <code>%APPDATA%\postgresql\pgpass.conf</code> file on Windows. Set the permissions so that only you can read/write the <code>pgpass.conf</code> file. The file can be deleted after installation if required. The file should look something like this. Change the last item on the two lines to be the password for those users.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>localhost:5432:*:postgres:postgres
localhost:5432:*:cpf:cpf_0wn3r
</pre> 
   </div> 
  </div> 
 </section> 
 <section> 
  <h3 id="cpf_database_and_schema_install1">CPF Database and schema install</h3> 
  <p>The CPF installation process will create the following database objects. If the objects already exist the script will either ignore that step or in the case of CPF tables it will prompt to confirm that the existing tables should be deleted.</p> 
  <ul> 
   <li>Create a cpf database for PostgreSQL. An existing Oracle database must already exist.</li> 
   <li>Create a <code>CPF tablespace</code> to store the CPF data.</li> 
   <li>Create a <code>CPF_WEB_PROXY</code> database role that will have CRUD permission on the tables.</li> 
   <li>Create a <code>CPF</code> database user account that this the owner of all the CPF tables. <b>NOTE:</b> This account must not be used for any other purpose than managing the table definitions.</li> 
   <li>Create a <code>PROXY_CPF_WEB</code> user account that is used by the CPF web application to access the database.</li> 
   <li>Create a <code>CPF</code> schema for all of the CPF tables, sequences and indexes.</li> 
   <li>Create all the CPF tables, sequences and indexes and grant appropriate permissions for these tables.</li> 
  </ul> 
  <p>NOTE: For Oracle you will need to know the password for the SYSTEM database account, you will be prompted to enter this in the script.</p> 
  <p><b>Unix/Mac</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>DB_VENDOR={postgresql|oracle}
cd cpf/sql/${DB_VENDOR}
chmod 755 install.sh
./install.sh
</pre> 
   </div> 
  </div> 
  <p><b>Windows</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>set DB_VENDOR={postgresql|oracle}
cd  cpf\sql\%DB_VENDOR%
install.cmd
</pre> 
   </div> 
  </div> 
  <p>During the installation script you may be prompted for the following information.</p> 
  <ul> 
   <li>Passwords for the <code>SYSTEM</code> or <code>postgres</code> user accounts.</li> 
   <li>If the database already exists the following prompt will be displayed. Entering <b>YES</b> will delete all the existing data and create new tables.<br> <code>WARN: Do you want to drop the existing database including all data (YES/NO)?</code></li> 
  </ul> 
  <blockquote> 
   <p><b>NOTE:</b> Contact the CPF developer, if there are any errors while running the script that are NOT related to file permissions or unknown user account passwords.</p> 
  </blockquote> 
 </section> 
</section> 
<section> 
 <h2 id="web_application_installation1">Web Application Installation</h2> 
 <p>A local copy of the CPF web applications and databases should be deployed at the developer’s site. For projects with multiple developers it is recommended to install a local database and J2EE servlet container (Apached Tomcat) on each developer’s workstation and one on a central integration test server.</p> 
 <p>The CPF applications are deployed to a J2EE application server or servlet container. To deploy to a J2EE Servlet container the individual wars are deployed to the J2EE Servlet container.</p> 
 <p>Deployment is currently supported on <a class="externalLink" href="https://tomcat.apache.org">Apache Tomcat &gt; 9.0.x</a>. CPF may work withother J2EE Servlet or application containers but this has not been tested.</p> 
 <p>For Tomcat 9.0.x you will need to add a user account in the manager-script role to deploy the web applications to the tomcat contained. If a user does not exist edit the <code>tomcat-users.xml</code> file in the tomcat conf directory.</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>&lt;role rolename="manager-script"/&gt;
&lt;user username="admin" password="..." roles="manager-script"/&gt;
</pre> 
  </div> 
 </div> 
 <section> 
  <h3 id="create_cpf_directories1">Create CPF directories</h3> 
  <p>The CPF requires directories to be created on the server. The following directories must be created.</p> 
  <blockquote> 
   <p><b>NOTE</b>: This assumes the CPF home directory is /apps/cpf. Modify the commands and configuration below if a different directory is used.</p> 
  </blockquote> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Directory </th> 
     <th>User Perms</th> 
     <th>J2EE Server Perms</th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td><code>/apps/cpf/config</code> </td> 
     <td><code>rw</code> </td> 
     <td><code>r</code> </td> 
     <td>The directory containing the CPF configuration file for the database URL, username and password.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>/apps/cpf/log</code> </td> 
     <td><code>r</code> </td> 
     <td><code>rw</code> </td> 
     <td>The directory to store the CPF logs.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>/apps/cpf/repository,/home/{username}/.m2/repository</code> </td> 
     <td><code>rw</code> </td> 
     <td><code>rw</code> </td> 
     <td>The local Maven repository cache. If the J2EE server is on the developers workstation use the user’s local maven repository cache.</td> 
    </tr> 
   </tbody> 
  </table> 
  <p>Create the directories using the following commands. Make sure the directory permissions are set as shown in the table above.</p> 
  <p><b>UNIX/Mac</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>mkdir -p /apps/cpf
mkdir -p /apps/cpf/config
mkdir -p /apps/cpf/log
mkdir -p /apps/cpf/repository
</pre> 
   </div> 
  </div> 
  <p><b>Windows</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>md \apps\cpf
md \apps\cpf\config
md \apps\cpf\log
md \apps\cpf\repository
</pre> 
   </div> 
  </div> 
 </section> 
 <section> 
  <h3 id="update_maven_settingsxml_to_use_the_cpf_maven_repo">Update maven settings.xml to use the CPF maven repository</h3> 
  <p>Edit ~/.m2/settings.xml to include the cpf-artifactory profile</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings
  xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd"
  xmlns="http://maven.apache.org/SETTINGS/1.1.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
&gt;
  &lt;profiles&gt;

    &lt;profile&gt;
      &lt;id&gt;cpf-artifactory&lt;/id&gt;
       &lt;activation&gt;
        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
      &lt;/activation&gt;
      &lt;repositories&gt;
        &lt;repository&gt;
          &lt;id&gt;cpf-release-local&lt;/id&gt;
          &lt;name&gt;cpf-release-local&lt;/name&gt;
          &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
          &lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
          &lt;/snapshots&gt;
          &lt;url&gt;https://open.revolsys.com/artifactory/cpf-release-local&lt;/url&gt;
        &lt;/repository&gt;
        &lt;repository&gt;
          &lt;id&gt;cpf-snapshot-local&lt;/id&gt;
          &lt;name&gt;cpf-snapshot-local&lt;/name&gt;
          &lt;releases&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
          &lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
          &lt;/snapshots&gt;
          &lt;url&gt;https://open.revolsys.com/artifactory/cpf-snapshot-local&lt;/url&gt;
        &lt;/repository&gt;
      &lt;/repositories&gt;
    &lt;/profile&gt;

  &lt;/profiles&gt;
&lt;/settings&gt;

</pre> 
   </div> 
  </div> 
 </section> 
 <section> 
  <h3 id="create_a_cpf_web_application_project1">Create a CPF web application project</h3> 
  <p>The CPF application can be configured to connect to different types of database and be configured or extended in other ways. Therefore instead of delivering a pre-packaged war file a maven project is created for each installation that contains the configuration for that environment.</p> 
  <p>Create the maven project using the following maven archetype commands. Replace any parameters with the correct values for your environment.</p> 
  <blockquote> 
   <p><b>NOTE:</b> Java 11 and Maven 3.6+ must be install. JAVA_HOME and M2_HOME must be set and the bin directories from both must be in the PATH.</p> 
  </blockquote> 
  <p><b>UNIX/Mac</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>CPF_VERSION=6.1.x-SNAPSHOT
cd ~/projects
mvn \
  archetype:generate \
  -DarchTypeCatalog=cpf-release-local,cpf-snapshot-local,remote,local \
  -DinteractiveMode=false \
  -DarchetypeGroupId=ca.bc.gov.open.cpf \
  -DarchetypeArtifactId=cpf-archetype-web \
  -DarchetypeVersion=${CPF_VERSION} \
  -DgroupId=com.mycompany \
  -DartifactId=cpf \
  -Dversion=1.0.0-SNAPSHOT \
  -DcpfVersion=${CPF_VERSION} \
  -DmodulePrefix=cpf \
  -DdatabaseVendor=postgresql \
  -DdatabasePassword=c0ncurr3n7 \
  -DworkerPassword=cpf_w0rk3r \
  -DcpfLogDirectory=/apps/cpf/log \
  -DcpfDirectoryUrl=file:///apps/cpf \
  -DmavenCacheDirectoryUrl=file:///apps/cpf/repository
</pre> 
   </div> 
  </div> 
  <p><b>Windows</b></p> 
  <div class="source"> 
   <div class="source"> 
    <pre>set CPF_VERSION=6.1.x-SNAPSHOT
cd %HOMEDRIVE%%HOMEPATH%\projects
mvn ^
  archetype:generate ^
  -DarchTypeCatalog=cpf-release-local,cpf-snapshot-local,remote,local ^
  -DinteractiveMode=false ^
  -DarchetypeGroupId=ca.bc.gov.open.cpf ^
  -DarchetypeArtifactId=cpf-archetype-web ^
  -DarchetypeVersion=%CPF_VERSION% ^
  -DgroupId=com.mycompany ^
  -DartifactId=cpf ^
  -Dversion=1.0.0-SNAPSHOT ^
  -DcpfVersion=%CPF_VERSION% ^
  -DmodulePrefix=cpf ^
  -DdatabaseVendor=postgresql ^
  -DdatabasePassword=c0ncurr3n7 ^
  -DworkerPassword=cpf_w0rk3r ^
  -DcpfLogDirectory=C:/apps/cpf/log ^
  -DcpfDirectoryUrl=file:///C:/apps/cpf ^
  -DmavenCacheDirectoryUrl=file:///C:/apps/cpf/repository
</pre> 
   </div> 
  </div> 
  <blockquote> 
   <p><b>NOTE:</b> Windows and Unix require commands to be entered on a single line. The \ or ^ character are line continuation character that treats multiple lines as a single line. Therefore you can cut and paste the above text into a command window.</p> 
  </blockquote> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Parameter </th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td><code>archetypeVersion</code> </td> 
     <td>The most recent version of the CPF framework.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpfVersion</code> </td> 
     <td>The most recent version of the CPF framework.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>groupId</code> </td> 
     <td>The maven group identifier. This should be your company name if deploying within your development environment.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>artifactId</code> </td> 
     <td>The base maven artifact identifier used for the maven modules created in the project.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>version</code> </td> 
     <td>The version identifier you’d like to give to your plug-in.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>modulePrefix</code> </td> 
     <td>The prefix to use on the web applications.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>databaseVendor</code> </td> 
     <td>The database type that the CPF uses for its data. Supported values include postgresql and oracle.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>databasePassword</code> </td> 
     <td>The password for the PROXY_CPF_WEB user (PROXY_CPF_WEB_PASSWORD from db.properties). </td> 
    </tr> 
    <tr class="b"> 
     <td><code>workerPassword</code> </td> 
     <td>The password for the cpf_worker CPF user account. Default is cpf_w0rk3r. Change if required using the CPF admin application.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpfLogDirectory</code> </td> 
     <td>The directory for the CPF log files will be stored in (e.g. <code>/apps/cpf/log</code> or <code>C:\apps\cpf\log</code>).</td> 
    </tr> 
    <tr class="b"> 
     <td><code>cpfDirectoryUrl</code> </td> 
     <td>The root directory the CPF configuration file and log files will be stored in (e.g. <code>file:///apps/cpf</code> or <code>file:///C:/apps/cpf</code>).</td> 
    </tr> 
    <tr class="a"> 
     <td><code>mavenCacheDirectoryUrl</code></td> 
     <td>The file URL to local Maven repository cache. <b>NOTE:</b>. If the J2EE server is on the developers workstation use the user Must start with <a class="externalLink" href="file:///">file:///</a> and use web slashes / instead of windows slashes ’s local maven repository cache. Otherwise use the repository directory below the <code>cpfDirectory</code> defined above (e.g. <code>file:///apps/cpf/repository</code> or <code>file:///C:/apps/cpf/repository</code>).</td> 
    </tr> 
   </tbody> 
  </table> 
  <p>The following directory structure would be created if the command were run using the parameters above.</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>File/Directory </th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td><code>cpf</code> </td> 
     <td>The root directory of the web project.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpf.app</code> </td> 
     <td>The maven module for the web application containing the web services and scheduler.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>pom.xml</code> </td> 
     <td>The maven build file for the web services and scheduler.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>src/main/resources</code> </td> 
     <td>The resources to be included in the web application jar file.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>cpf-api-properties.sf.xml</code> </td> 
     <td>The configuration file for the CPF API components.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpf-web-properties.sf.xml</code> </td> 
     <td>The configuration file for the CPF web components.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>src/main/webapp/META-INF/context.xml</code></td> 
     <td>Tomcat context configuration.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>src/main/webapp/WEB-INF/web.xml</code> </td> 
     <td>The web.xml file.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>cpf.worker</code> </td> 
     <td>The maven module for the web application containing the worker.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>pom.xml</code> </td> 
     <td>The maven build file for the worker.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>src/main/resources</code> </td> 
     <td>The resources to be included in the web applications jar file.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpfWorker.json</code> </td> 
     <td>The configuration file for the worker.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>src/main/webapp/META-INF/context.xml</code></td> 
     <td>Tomcat context configuration.</td> 
    </tr> 
    <tr class="a"> 
     <td><code>pom.xml</code> </td> 
     <td>The parent maven build file that builds all modules.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>sample-config/cpf.properties</code> </td> 
     <td>A sample config file to copy to <code>/apps/cpf/conf/</code>.</td> 
    </tr> 
   </tbody> 
  </table> 
  <blockquote> 
   <p><b>NOTE:</b> Developers shouldn’t need to edit any of these configuration files. They are populated using the parameters specified in the maven archetype. If you need to change the cpf directory location or the database vendor it’s probably easier to delete the project and create a new project using the maven archetype. All database configurations are done using runtime configuration files and plug-in configuration is stored in the database.</p> 
  </blockquote> 
 </section> 
 <section> 
  <h3 id="maven_settings_configuration1">Maven Settings Configuration</h3> 
  <p>A profile must be created in the <code>~/.m2/settings.xml</code> for each server environment that the CPF components are deployed to. The following example shows a full settings file with a single profile for the localhost server.</p> 
  <p>If you want to deploy the application to multiple servers you can create a profile for each server in your <code>~/.m2/settings.xml</code>. The profile id should be the name of the server to deploy to. For example the following shows a profile for the localhost.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;settings&gt;
&nbsp; &lt;profile&gt;
&nbsp; &nbsp;&nbsp;&lt;id&gt;localhost&lt;/id&gt;
&nbsp;&nbsp; &nbsp;&lt;properties&gt;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&lt;!-- Include the following for Tomcat deployment --&gt;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&lt;tomcatManagerUrl&gt;http://localhost:8080/manager/text&lt;/tomcatManagerUrl&gt;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&lt;tomcatManagerUsername&gt;admin&lt;/tomcatManagerUsername&gt;
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&lt;tomcatManagerPassword&gt;...&lt;/tomcatManagerPassword&gt;
&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
&nbsp; &lt;/profile&gt;
&lt;/settings&gt;
</pre> 
   </div> 
  </div> 
 </section> 
 <section> 
  <h3 id="cpf_runtime_configuration1">CPF Runtime Configuration</h3> 
  <p>Any configuration that changes from one server to another is included in a runtime configuration file in the <code>/apps/cpf/config</code> directory on the server. No environment specific configuration is included in the compiled WAR files, i.e. the same war could be deployed to delivery, test and production environments.</p> 
  <p>Copy the <code>sample-config/cpf.properties</code> file to the <code>/apps/cpf/config/cpf.properties</code> directory on the server.</p> 
  <table border="0" class="bodyTable table table-striped table-hover"> 
   <thead> 
    <tr class="a"> 
     <th>Property </th> 
     <th>Description</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr class="b"> 
     <td><code>cpfConfig.baseUrl</code> </td> 
     <td>The base URL to the CPF apps web application (e.g. <code>http://localhost/pub/cpf</code>).</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpfDataSource.url</code> </td> 
     <td>The full JDBC URL to the CPF database server (e.g. jdbc:postgresql:cpf).</td> 
    </tr> 
    <tr class="b"> 
     <td><code>cpfDataSource.password</code> </td> 
     <td>The password for the CPF database (e.g. c0ncurr3n7).</td> 
    </tr> 
    <tr class="a"> 
     <td><code>cpfWorker.webServiceUrl</code></td> 
     <td>The base url to the internal web services (e.g. <code>http://localhost:8080/pub/cpf</code>). Must be the direct tomcat HTTP port and not behind an Apache reverse proxy.</td> 
    </tr> 
    <tr class="b"> 
     <td><code>cpfWorker.password</code> </td> 
     <td>The password used in the internal web services (e.g. cpf_w0rk3r). Must be an <code>http://open.gov.bc.ca/cpf/SystemUser</code> user in the cpf.cpf_user_accounts table.</td> 
    </tr> 
   </tbody> 
  </table> 
 </section> 
 <section> 
  <h3 id="external_maven_repository_configuration1">External Maven Repository Configuration</h3> 
  <p>If the CPF is not deployed on the development server then the worker will need to be configured to point to the maven respositories that the CPF plug-ins are deployed to.</p> 
  <p>Edit the following configuration file. You will need to re-build and deploy if this file is modified.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>~/projects/cpf/cpf.app/src/main/resources/cpf-web-properties.sf.xml
</pre> 
   </div> 
  </div> 
  <p>Add the following entries to the cpfWebProperties map. The first entry must be modified to the value used for the mavenCacheDirectory specified above. The second entry value must be the local file URL or remote http URL to a shared maven repository that you will deploy the plug-ins to. See <a class="externalLink" href="http://maven.apache.org/plug-ins/maven-deploy-plug-in/">Maven Deploy Plug-in</a> for deploying to a maven repository.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;entry
&nbsp;&nbsp;key="mavenRepository.root"
&nbsp;&nbsp;value="file:///apps/cpf/repository/"
/&gt;

&lt;entry key="mavenRepository.repositoryLocations"&gt;
  &lt;list&gt;
    &lt;value&gt;http://mycompany.com/maven/repository/&lt;/value&gt;
  &lt;/list&gt;
&lt;/entry&gt;
</pre> 
   </div> 
  </div> 
 </section> 
 <section> 
  <h3 id="deploy_to_tomcat_901">Deploy to Tomcat 9.0</h3> 
  <p>The plug-in project web services &amp; scheduler war and worker war files can be deployed to a Tomcat 9 server.</p> 
  <p>Use the following command to compile and deploy to Tomcat.</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>mvn -P tomcat9Deploy,localhost clean install
</pre> 
   </div> 
  </div> 
  <p>If you created multiple profiles use the profile name of the server you wish to deploy to.</p> 
 </section> 
</section>                    </main>
        <div class="d-none d-sm-none d-md-none d-lg-none d-xl-block col-xl-2">
            </div>
    </div> <!-- row: end -->
</div> <!-- .main-body: end -->
    <div id="m-scroll-top" style="display: none;">
        <a href="javascript:;">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
  <!-- Footer -->
<footer class="footer-light bg-light">
    <div class="container">
        <div class="row">
                        <div class="col bottom-nav">
                <ul class="nav flex-column nav-list">
                </ul>
            </div>
        </div> <!-- END: .row -->
    </div> <!-- END: .container -->
</footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="copyright">Copyright &copy;2008-2021
                 <a href="https://www.gov.bc.ca/">Province of British Columbia</a>
. All Rights Reserved.</p>
        <p class="version-date">
<span class="projectVersion">Version: 6.1.x-SNAPSHOT. </span><span class="publishDate">
    Last Published: 2021-Mar-15
. </span>        </p>
      </div>
    </div>
  </div>

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/${popperVersion}/umd//popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

  <script src="./js/lightbox.min.js" crossorigin="anonymous"></script>
            		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js" crossorigin="anonymous"></script>
              <script src="./js/reflow-skin.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js" crossorigin="anonymous"></script>
    </body>
</html>
